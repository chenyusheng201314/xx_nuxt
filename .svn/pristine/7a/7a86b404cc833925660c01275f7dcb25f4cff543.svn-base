webpackJsonp([29,89],{DBaW:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("uCFH"),i=a.n(s);for(var n in s)"default"!==n&&function(e){a.d(t,e,function(){return s[e]})}(n);var o=a("gN7q"),d=!1;var l=function(e){d||a("qJZn")},r=a("VU/8")(i.a,o.a,!1,l,"data-v-0b091a10",null);r.options.__file="pages\\admin\\video.vue",t.default=r.exports},DUAh:function(e,t,a){"use strict";var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("input",{style:e.m_style,attrs:{type:"file",id:"upload",value:"多文件上传",multiple:"",accept:e.mime,disabled:!e.upload_type},on:{click:function(t){e.getUpload()}}}),a("div",{directives:[{name:"show",rawName:"v-show",value:e.cover_show,expression:"cover_show"}],staticClass:"up-lists-cover"},[a("div",{staticClass:"cover-con"},[a("h3",[e._v("上传列表")]),a("ul",e._l(e.upload_item,function(t,s){return a("li",{key:s},[e._m(0,!0),a("div",{staticClass:"upload_name"},[a("p",[e._v(e._s(t.name))]),a("p",[e._v(e._s(e._f("b_to_mb")(t.pro_size))+"MB/"+e._s(e._f("b_to_mb")(t.size))+"MB")])]),a("div",{staticClass:"upload_process"},[a("div",{staticClass:"upload_process_in",style:{width:t.process}})]),a("div",{staticClass:"upload_percent"},[e._v(e._s(t.process))]),a("div",{staticClass:"upload_status"},[a("span",{staticClass:"badge",class:{badge_info_b:0===t.state,badge_primary_b:1===t.state,badge_warning_b:2===t.state,badge_success_b:3===t.state}},[e._v(e._s(0===t.state?"等待中":1===t.state?"上传中":2===t.state?"已暂停":"已完成"))])]),a("div",{staticClass:"upload_control"},[a("i",{directives:[{name:"show",rawName:"v-show",value:1===t.state,expression:"item.state=== 1"}],staticClass:"iconfont",attrs:{"data-toggle":"tooltip","data-placement":"top","data-original-title":"暂停"},on:{click:function(a){e.upload_stop(t.uploader,s)}}},[e._v("")]),a("i",{directives:[{name:"show",rawName:"v-show",value:2===t.state,expression:"item.state===2"}],staticClass:"iconfont",attrs:{"data-toggle":"tooltip","data-placement":"top","data-original-title":"恢复上传"},on:{click:function(a){e.upload_start(t.uploader,s)}}},[e._v("")])])])})),a("div",{staticClass:"remove-list",on:{click:function(t){e.close_cover(!1)}}},[e._v("收起上传列表")])])])])};s._withStripped=!0;var i={render:s,staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"icon"},[t("img",{attrs:{src:"/admin/images/class/icon-video.png",alt:""}})])}]};t.a=i},H8Uz:function(e,t,a){"use strict";var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"left_nav"},[a("ul",e._l(e.data,function(t,s){return a("li",{key:s,class:{active:t.active},on:{click:function(t){e.nav_choose(s)}}},[e._v("\n      "+e._s(t.name)+"\n    ")])}))])};s._withStripped=!0;var i={render:s,staticRenderFns:[]};t.a=i},OzZH:function(e,t){},TxpG:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a("OzZH"),function(e){return e&&e.__esModule?e:{default:e}}(a("/5sW")).default.filter("b_to_mb",function(e){return(e/1024/1024).toFixed(2)}),t.default={name:"u_video",layout:"admin",props:["mime","m_style","cover_show"],data:function(){return{vsrc:"",vsrc1:"",vsrc_t:"",vsrc_t1:"",upload_item:[],upload_control_item:[],upload_vedio_nums:0,upload_index:0,upload_index_a:0,uploadCount:0,upload_type:!0}},methods:{myFunction:function(e,t){console.log("myFunction",e),console.log("565656",this.vsrc_t)},get_voucher:function(e,t,a,s){var i;return jQuery.ajax({url:this.$store.state.admin.baseUrl+"/common/video/create_upload",type:"POST",dataType:"json",headers:{token:this.$store.state.admin.token},async:!1,data:{title:e,filename:t,filesize:a,description:"",coverurl:"",cateid:s,tags:""},success:function(e){i=e}}),i},update_voucher:function(e){jQuery.ajax({url:this.$store.state.admin.baseUrl+"/common/video/refresh_upload",type:"POST",dataType:"json",headers:{token:this.$store.state.admin.token},data:{videoid:e},success:function(e){}})},create_uploader:function(e,t,a,s,i,n){var o=this,d=new AliyunUpload.Vod({partSize:1048576,parallel:5,retryCount:3,retryDuration:2,onUploadstarted:function(i){o.upload_item[s].state=1,o.upload_vedio_nums++,o.$emit("video_list_type_change",!0),console.log("开始上传了......"),o.upload_type=!1,o.close_cover(!0),d.setUploadAuthAndAddress(i,e,t,a)},onUploadSucceed:function(e){o.upload_item[s].state=3,o.upload_vedio_nums--;var t=e.file.name,n=e.file.type.split("/")[1];o.update_upload_item(),console.log("完成",e),jQuery.ajax({url:o.$store.state.admin.baseUrl+"/manage/manage_video/video_add",type:"POST",dataType:"json",headers:{token:o.$store.state.admin.token},data:{upload_name:t,video_id:a,size:i,duration:0,video_type:n},success:function(e){console.log(t+"已经保存成功")}})},onUploadFailed:function(e,t,a){console.log("你倒霉了，上传失败了......"),console.log("onUploadFailed: file:"+e.file.name+",code:"+t+", message:"+a)},onUploadProgress:function(e,t,a){o.upload_item[s].process=Math.ceil(100*a)+"%",o.upload_item[s].pro_size=Math.ceil(100*a)/100*o.upload_item[s].size,console.log("上传进度",Math.ceil(100*a)+"%")},onUploadTokenExpired:function(e){console.log("上传凭证超时了......"),console.log("onUploadTokenExpired"),this.update_voucher(a)},onUploadEnd:function(e){var t=1;o.upload_item.forEach(function(e,a){3===e.state?t=0:t++}),console.log(t),0===t&&(console.log("上传已经全部结束了......"),o.upload_type=!0,window.location.reload())}});return d},add_file:function(e,t){e.addFile(t,null,null,null,null)},delete_file:function(e,t){e.deleteFile(t)},cancle_file:function(e,t){e.cancelFile(0)},resume_file:function(e,t){e.resumeFile(0)},get_file_lists:function(e){e.listFiles();for(var t=e.listFiles(),a=0;a<t.length;a++)log("file:"+t[a].file.name+", status:"+t[a].state+", endpoint:"+t[a].endpoint+", bucket:"+t[a].bucket+", object:"+t[a].object)},clear_file_lists:function(e){e.cleanList()},upload_start:function(e,t){this.upload_vedio_nums<1&&(e.startUpload(),this.upload_item[t].state=1)},upload_stop:function(e,t){this.upload_item[t].state=2,e.stopUpload(),this.upload_vedio_nums--,this.update_upload_item()},resumeUploadWithAuth:function(e){e.resumeUploadWithAuth(uploadAuth)},setUploadAuthAndAddress:function(e){e.setUploadAuthAndAddress(uploadInfo,uploadAuth,uploadAddress,videoId)},update_upload_item:function(){for(var e=0;e<this.upload_control_item.length;e++)0==this.upload_control_item[e].state&&this.upload_start(this.upload_control_item[e].uploader,e)},close_cover:function(e){this.$emit("close_cover",e)},getUpload:function(){if(!this.comsys.adminCheckRole(this.$store.state.admin.adminRole.data,"manage_video","video_add"))return this.$message({message:"警告，您无此权限",type:"warning"}),!1;var e,t=this,a=$,s="";console.log(t.upload_type),t.upload_type&&(0==this.uploadCount&&document.getElementById("upload").addEventListener("change",function(i){for(var n=0,o=0,d=0;d<i.target.files.length;d++)if("video"===i.target.files[d].type.split("/")[0]?o+=0:o++,0===o){(new FileReader).onloadend=function(e){t.vsrc=e.target.result},console.log("文件属性",i.target.files[d]),s=t.get_voucher(i.target.files[d].name,i.target.files[d].name,i.target.files[d].size,536768796);var l=t.create_uploader(s.data.UploadAuth,s.data.UploadAddress,s.data.VideoId,t.upload_index_a,i.target.files[d].size,t.vsrc_t);t.add_file(l,i.target.files[d]),e={uploader:l,name:i.target.files[d].name,pro_size:"",size:i.target.files[d].size,process:0,state:0},t.upload_item.push(e),t.upload_control_item.push(e),n++,t.upload_index_a++}else t.$message.error("上传文件类型错误!");if(a("#file_prosess").modal("toggle"),n>1)t.upload_start(t.upload_control_item[t.upload_index].uploader,t.upload_index),t.upload_index++;else for(var r=0;r<n;r++)t.upload_start(t.upload_control_item[t.upload_index].uploader,t.upload_index),t.upload_index++}),t.uploadCount++)}},watch:{vsrc:function(e,t){this.myFunction()},upload_type:function(){this.$emit("upload_type_change",this.upload_type)}},mounted:function(){},head:function(){return{link:[{href:"/admin/css/up_video.css",type:"text/css",rel:"stylesheet"}],script:[{src:"/admin/js/es6-promise.min.js"},{src:"/admin/js/aliyun-oss-sdk4.13.2.min.js"},{src:"/admin/js/aliyun-upload-sdk1.3.1.min.js"},{src:"/admin/js/bootstrap.min.js"}]}}}},cJuq:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("niWl"),i=a.n(s);for(var n in s)"default"!==n&&function(e){a.d(t,e,function(){return s[e]})}(n);var o=a("H8Uz"),d=!1;var l=function(e){d||a("cdzv")},r=a("VU/8")(i.a,o.a,!1,l,null,null);r.options.__file="components\\admin\\LeftNav.vue",t.default=r.exports},cdzv:function(e,t){},gN7q:function(e,t,a){"use strict";var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("LeftNav",{attrs:{data:e.leftNav}}),a("div",{staticClass:"admin-video"},[a("h2",{staticClass:"title"},[e._v("视频库")]),a("ul",{staticClass:"video-classify"},[a("li",[a("span",[e._v("视频名称")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.search_info.name,expression:"search_info.name"}],staticClass:"inp",attrs:{type:"text"},domProps:{value:e.search_info.name},on:{input:function(t){t.target.composing||e.$set(e.search_info,"name",t.target.value)}}})]),a("li",{staticStyle:{"margin-right":"100px"}},[a("span",[e._v("上传时间")]),a("el-date-picker",{attrs:{type:"date","value-format":"yyyy-MM-dd 00:00:00",placeholder:"选择日期"},model:{value:e.search_info.time[0],callback:function(t){e.$set(e.search_info.time,0,t)},expression:"search_info.time[0]"}}),e._v("\n        -\n        "),a("el-date-picker",{attrs:{type:"date","value-format":"yyyy-MM-dd 23:59:59",placeholder:"选择日期"},model:{value:e.search_info.time[1],callback:function(t){e.$set(e.search_info.time,1,t)},expression:"search_info.time[1]"}})],1),a("li",[a("span",[e._v("是否被使用")]),a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.search_info.isUse,callback:function(t){e.$set(e.search_info,"isUse",t)},expression:"search_info.isUse"}},e._l(e.search_info.isUse_select,function(e,t){return a("el-option",{key:t,attrs:{label:e,value:e}})}))],1),a("li",{staticClass:"last-li"},[a("span",{directives:[{name:"show",rawName:"v-show",value:e.btn_show,expression:"btn_show"}],staticClass:"show-list",on:{click:e.show_up_list}},[e._v("视频传输列表")]),a("span",{staticClass:"video-up",class:{disable_up:!e.up_type}},[e._v("\n          "+e._s(e.up_type?"上传":"上传中...")+"\n          "),a("UpLoading",{attrs:{m_style:"opacity: 0;position: absolute;top: -2px;left:3px;width: 110px;height: 40px;",mime:"",cover_show:e.cover_show},on:{close_cover:e.close_cover,get_list_again:e.get_list_again,video_list_type_change:e.video_list_type_change,upload_type_change:e.upload_type_change}})],1),a("span",{staticClass:"video-search",on:{click:e.video_search}},[e._v("搜索")])])]),a("table",{staticClass:"video-list"},[e._m(0),a("tbody",e._l(e.video_lists,function(t,s){return a("tr",{key:s},[a("td",{attrs:{width:"80px"}},[e._v(e._s(s+1))]),a("td",{attrs:{width:"500px"}},[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:t.show_name,placement:"top"}},[a("el-button",[e._v(e._s(t.show_name))])],1)],1),a("td",{attrs:{width:"150px"}},[e._v(e._s(""===t.duration?"--":(t.duration/60).toFixed(1))+"分钟")]),a("td",{attrs:{width:"150px"}},[e._v(e._s(t.video_type))]),a("td",{attrs:{width:"250px"}},[e._v(e._s(t.updated_at))]),a("td",{attrs:{width:"150px"}},[a("span",{directives:[{name:"show",rawName:"v-show",value:parseInt(t.is_used)>0,expression:"parseInt(item.is_used) > 0"}],staticClass:"col-sure"},[e._v("是")]),a("span",{directives:[{name:"show",rawName:"v-show",value:parseInt(t.is_used)<=0,expression:"parseInt(item.is_used) <= 0"}],staticClass:"col-error"},[e._v("否")])]),a("td",{attrs:{width:"250px"}},[a("span",{staticClass:"delete-one",on:{click:function(a){e.delete_one(t.id,t)}}},[e._v("删除")]),a("span",{staticClass:"updata",on:{click:function(a){e.updata_time(t,s)}}},[e._v("更新时长")])])])}))]),a("div",{staticClass:"paging"},[a("el-pagination",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],attrs:{"current-page":e.paging.currentPage,"page-sizes":e.paging.page_sizes,"page-size":e.paging.page_size,layout:"prev, pager, next, sizes, jumper",total:e.paging.total,"pager-count":5},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange,"update:currentPage":function(t){e.$set(e.paging,"currentPage",t)}}})],1)])],1)};s._withStripped=!0;var i={render:s,staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("tr",[t("th",[this._v("序号")]),t("th",[this._v("视频名称")]),t("th",[this._v("时长")]),t("th",[this._v("类型")]),t("th",[this._v("上传时间")]),t("th",[this._v("是否被使用")]),t("th",[this._v("操作")])])}]};t.a=i},niWl:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"leftNav",props:["data"],data:function(){return{}},methods:{nav_choose:function(e){var t=this;$.each(t.data,function(a,s){a===e?(s.active=!0,console.log(s.name),t.$store.commit("setNav",s.name)):s.active=!1}),this.$router.push({path:t.data[e].link})}},mounted:function(){for(var e in this.data)this.data[e].link==this.$route.path?(this.data[e].active=!0,this.$store.commit("setNav",this.data[e].name)):this.data[e].active=!1},watch:{data:function(e){for(var t in this.data)this.data[t].link==this.$route.path?(this.data[t].active=!0,this.$store.commit("setNav",this.data[t].name)):this.data[t].active=!1}}}},o1tr:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("TxpG"),i=a.n(s);for(var n in s)"default"!==n&&function(e){a.d(t,e,function(){return s[e]})}(n);var o=a("DUAh"),d=!1;var l=function(e){d||a("qL/W")},r=a("VU/8")(i.a,o.a,!1,l,"data-v-4d6f5a6e",null);r.options.__file="pages\\admin\\u_video.vue",t.default=r.exports},qJZn:function(e,t){},"qL/W":function(e,t){},uCFH:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=l(a("Xxa5")),i=l(a("exGp")),n=l(a("cJuq")),o=l(a("o1tr")),d=l(a("mtWM"));function l(e){return e&&e.__esModule?e:{default:e}}l(a("/5sW")).default.filter("b_to_mb",function(e){return(e/1024/1024).toFixed(2)}),t.default={layout:"admin",name:"admin-video",components:{LeftNav:n.default,UpLoading:o.default},data:function(){return{leftNav:[],fullscreenLoading:!1,search_info:{id:"",name:"",time:[],isUse_select:["全部","是","否"],isUse:"全部"},cover_show:!1,up_type:!0,btn_show:!1}},asyncData:function(){var e=(0,i.default)(s.default.mark(function e(t){var a,i,n=t.store;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a={url:"/manage/manage_video/video_list",data:{page:1,psize:20,role:1,is_used:"",video_id:"",show_name:"",create_start_time:"",create_end_time:""}},e.next=3,n.dispatch("adminHttpGet",a);case 3:return i=e.sent,e.abrupt("return",{paging:{currentPage:1,page_sizes:[10,20,30],page_size:20,total:i.data.total},video_lists:i.data.data.data,headers:{token:n.state.admin.token}});case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),methods:{video_paging:function(){var e=(0,i.default)(s.default.mark(function e(){var t,a,i;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(t=this).fullscreenLoading=!0,a={url:"/manage/manage_video/video_list",data:{page:t.paging.currentPage,psize:t.paging.page_size,is_used:"全部"===t.search_info.isUse?"":"是"===t.search_info.isUse?1:0,video_id:t.search_info.id,show_name:t.search_info.name,create_start_time:t.search_info.time?t.search_info.time[0]:"",create_end_time:t.search_info.time?t.search_info.time[1]:""}},e.next=5,this.$store.dispatch("adminHttpGet",a);case 5:0===(i=e.sent).code&&(t.fullscreenLoading=!1),t.paging.total=i.data.data.total,t.video_lists=i.data.data.data;case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),handleSizeChange:function(e){this.paging.page_size=e,this.paging.currentPage=1,this.video_paging()},handleCurrentChange:function(e){this.paging.currentPage=e,this.video_paging()},delete_one:function(e,t){var a=this,s=this;if(!this.comsys.adminCheckRole(this.$store.state.admin.adminRole.data,"manage_video","video_del"))return this.$message({message:"警告，您无此权限",type:"warning"}),!1;this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(){0!==t.is_used?s.$message.error("被使用的视频无法删除!"):(0,d.default)({url:"/manage/manage_video/video_del",baseURL:s.$store.state.admin.baseUrl,method:"post",headers:{token:s.$store.state.admin.token},data:{id:e}}).then(function(e){0===e.data.code&&(s.video_paging(),s.$message({type:"success",message:"删除成功!"}))}).catch(function(e){console.log(e)})}).catch(function(){a.$message({type:"info",message:"已取消删除"})})},video_search:function(){this.video_paging()},show_up_list:function(){this.cover_show=!0},close_cover:function(e){this.cover_show=e},get_list_again:function(e){this.cover_show=!1,e&&this.video_paging()},upload_type_change:function(e){this.up_type=e},setMeau:function(){var e=[],t=this.$store.state.admin.adminRole.data,a=this.comsys.adminGetMeau(t,"manage_course"),s=this.comsys.adminGetMeau(t,"manage_video"),i=[],n=[],o=[];s.length>0&&(i=this.comsys.adminGetMeau(s[0].son,"video_list")),a.length>0&&(n=this.comsys.adminGetMeau(a[0].son,"course_list"),o=this.comsys.adminGetMeau(a[0].son,"course_sort_list")),i.length>0&&e.push({name:"视频库",link:"/admin/video",active:!0}),n.length>0&&e.push({name:"课程管理",link:"/admin/class",active:!1}),o.length>0&&e.push({name:"课程分类管理",link:"/admin/classification",active:!1}),this.leftNav=e},updata_time:function(e,t){var a=this;console.log("sdad",parseInt(e.duration)),0===parseInt(e.duration)?(0,d.default)({url:"/common/video/video_duration_save",method:"post",baseURL:a.$store.state.admin.baseUrl,headers:{token:a.$store.state.admin.token},data:{videoid:e.video_id}}).then(function(e){console.log(e),0===e.data.code?(a.video_lists[t].duration=e.data.data.toFixed(2),a.$message({type:"success",message:"更新成功!"})):a.$message.error("更新失败！")}).catch(function(e){console.log(e)}):a.$message({message:"已是最新数据，无需更新!",type:"warning"})},video_list_type_change:function(e){this.btn_show=e}},mounted:function(){this.setMeau()},head:function(){return{title:"课程管理",link:[{href:"/admin/css/up_video.css",type:"text/css",rel:"stylesheet"},{href:"/admin/css/video.css",type:"text/css",rel:"stylesheet"}],script:[{src:"/admin/js/es6-promise.min.js"},{src:"/admin/js/aliyun-oss-sdk4.13.2.min.js"},{src:"/admin/js/aliyun-upload-sdk1.3.1.min.js"},{src:"/admin/js/bootstrap.min.js"}]}}}}});