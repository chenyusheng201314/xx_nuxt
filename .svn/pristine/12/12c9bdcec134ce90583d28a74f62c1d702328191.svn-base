webpackJsonp([89],{DUAh:function(e,t,o){"use strict";var a=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("input",{style:e.m_style,attrs:{type:"file",id:"upload",value:"多文件上传",multiple:"",accept:e.mime,disabled:!e.upload_type},on:{click:function(t){e.getUpload()}}}),o("div",{directives:[{name:"show",rawName:"v-show",value:e.cover_show,expression:"cover_show"}],staticClass:"up-lists-cover"},[o("div",{staticClass:"cover-con"},[o("h3",[e._v("上传列表")]),o("ul",e._l(e.upload_item,function(t,a){return o("li",{key:a},[e._m(0,!0),o("div",{staticClass:"upload_name"},[o("p",[e._v(e._s(t.name))]),o("p",[e._v(e._s(e._f("b_to_mb")(t.pro_size))+"MB/"+e._s(e._f("b_to_mb")(t.size))+"MB")])]),o("div",{staticClass:"upload_process"},[o("div",{staticClass:"upload_process_in",style:{width:t.process}})]),o("div",{staticClass:"upload_percent"},[e._v(e._s(t.process))]),o("div",{staticClass:"upload_status"},[o("span",{staticClass:"badge",class:{badge_info_b:0===t.state,badge_primary_b:1===t.state,badge_warning_b:2===t.state,badge_success_b:3===t.state}},[e._v(e._s(0===t.state?"等待中":1===t.state?"上传中":2===t.state?"已暂停":"已完成"))])]),o("div",{staticClass:"upload_control"},[o("i",{directives:[{name:"show",rawName:"v-show",value:1===t.state,expression:"item.state=== 1"}],staticClass:"iconfont",attrs:{"data-toggle":"tooltip","data-placement":"top","data-original-title":"暂停"},on:{click:function(o){e.upload_stop(t.uploader,a)}}},[e._v("")]),o("i",{directives:[{name:"show",rawName:"v-show",value:2===t.state,expression:"item.state===2"}],staticClass:"iconfont",attrs:{"data-toggle":"tooltip","data-placement":"top","data-original-title":"恢复上传"},on:{click:function(o){e.upload_start(t.uploader,a)}}},[e._v("")])])])})),o("div",{staticClass:"remove-list",on:{click:function(t){e.close_cover(!1)}}},[e._v("收起上传列表")])])])])};a._withStripped=!0;var s={render:a,staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"icon"},[t("img",{attrs:{src:"/admin/images/class/icon-video.png",alt:""}})])}]};t.a=s},OzZH:function(e,t){},TxpG:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o("OzZH"),function(e){return e&&e.__esModule?e:{default:e}}(o("/5sW")).default.filter("b_to_mb",function(e){return(e/1024/1024).toFixed(2)}),t.default={name:"u_video",layout:"admin",props:["mime","m_style","cover_show"],data:function(){return{vsrc:"",vsrc1:"",vsrc_t:"",vsrc_t1:"",upload_item:[],upload_control_item:[],upload_vedio_nums:0,upload_index:0,upload_index_a:0,uploadCount:0,upload_type:!0}},methods:{myFunction:function(e,t){console.log("myFunction",e),console.log("565656",this.vsrc_t)},get_voucher:function(e,t,o,a){var s;return jQuery.ajax({url:this.$store.state.admin.baseUrl+"/common/video/create_upload",type:"POST",dataType:"json",headers:{token:this.$store.state.admin.token},async:!1,data:{title:e,filename:t,filesize:o,description:"",coverurl:"",cateid:a,tags:""},success:function(e){s=e}}),s},update_voucher:function(e){jQuery.ajax({url:this.$store.state.admin.baseUrl+"/common/video/refresh_upload",type:"POST",dataType:"json",headers:{token:this.$store.state.admin.token},data:{videoid:e},success:function(e){}})},create_uploader:function(e,t,o,a,s,i){var n=this,l=new AliyunUpload.Vod({partSize:1048576,parallel:5,retryCount:3,retryDuration:2,onUploadstarted:function(s){n.upload_item[a].state=1,n.upload_vedio_nums++,n.$emit("video_list_type_change",!0),console.log("开始上传了......"),n.upload_type=!1,n.close_cover(!0),l.setUploadAuthAndAddress(s,e,t,o)},onUploadSucceed:function(e){n.upload_item[a].state=3,n.upload_vedio_nums--;var t=e.file.name,i=e.file.type.split("/")[1];n.update_upload_item(),console.log("完成",e),jQuery.ajax({url:n.$store.state.admin.baseUrl+"/manage/manage_video/video_add",type:"POST",dataType:"json",headers:{token:n.$store.state.admin.token},data:{upload_name:t,video_id:o,size:s,duration:0,video_type:i},success:function(e){console.log(t+"已经保存成功")}})},onUploadFailed:function(e,t,o){console.log("你倒霉了，上传失败了......"),console.log("onUploadFailed: file:"+e.file.name+",code:"+t+", message:"+o)},onUploadProgress:function(e,t,o){n.upload_item[a].process=Math.ceil(100*o)+"%",n.upload_item[a].pro_size=Math.ceil(100*o)/100*n.upload_item[a].size,console.log("上传进度",Math.ceil(100*o)+"%")},onUploadTokenExpired:function(e){console.log("上传凭证超时了......"),console.log("onUploadTokenExpired"),this.update_voucher(o)},onUploadEnd:function(e){var t=1;n.upload_item.forEach(function(e,o){3===e.state?t=0:t++}),console.log(t),0===t&&(console.log("上传已经全部结束了......"),n.upload_type=!0,window.location.reload())}});return l},add_file:function(e,t){e.addFile(t,null,null,null,null)},delete_file:function(e,t){e.deleteFile(t)},cancle_file:function(e,t){e.cancelFile(0)},resume_file:function(e,t){e.resumeFile(0)},get_file_lists:function(e){e.listFiles();for(var t=e.listFiles(),o=0;o<t.length;o++)log("file:"+t[o].file.name+", status:"+t[o].state+", endpoint:"+t[o].endpoint+", bucket:"+t[o].bucket+", object:"+t[o].object)},clear_file_lists:function(e){e.cleanList()},upload_start:function(e,t){this.upload_vedio_nums<1&&(e.startUpload(),this.upload_item[t].state=1)},upload_stop:function(e,t){this.upload_item[t].state=2,e.stopUpload(),this.upload_vedio_nums--,this.update_upload_item()},resumeUploadWithAuth:function(e){e.resumeUploadWithAuth(uploadAuth)},setUploadAuthAndAddress:function(e){e.setUploadAuthAndAddress(uploadInfo,uploadAuth,uploadAddress,videoId)},update_upload_item:function(){for(var e=0;e<this.upload_control_item.length;e++)0==this.upload_control_item[e].state&&this.upload_start(this.upload_control_item[e].uploader,e)},close_cover:function(e){this.$emit("close_cover",e)},getUpload:function(){if(!this.comsys.adminCheckRole(this.$store.state.admin.adminRole.data,"manage_video","video_add"))return this.$message({message:"警告，您无此权限",type:"warning"}),!1;var e,t=this,o=$,a="";console.log(t.upload_type),t.upload_type&&(0==this.uploadCount&&document.getElementById("upload").addEventListener("change",function(s){for(var i=0,n=0,l=0;l<s.target.files.length;l++)if("video"===s.target.files[l].type.split("/")[0]?n+=0:n++,0===n){(new FileReader).onloadend=function(e){t.vsrc=e.target.result},console.log("文件属性",s.target.files[l]),a=t.get_voucher(s.target.files[l].name,s.target.files[l].name,s.target.files[l].size,536768796);var d=t.create_uploader(a.data.UploadAuth,a.data.UploadAddress,a.data.VideoId,t.upload_index_a,s.target.files[l].size,t.vsrc_t);t.add_file(d,s.target.files[l]),e={uploader:d,name:s.target.files[l].name,pro_size:"",size:s.target.files[l].size,process:0,state:0},t.upload_item.push(e),t.upload_control_item.push(e),i++,t.upload_index_a++}else t.$message.error("上传文件类型错误!");if(o("#file_prosess").modal("toggle"),i>1)t.upload_start(t.upload_control_item[t.upload_index].uploader,t.upload_index),t.upload_index++;else for(var u=0;u<i;u++)t.upload_start(t.upload_control_item[t.upload_index].uploader,t.upload_index),t.upload_index++}),t.uploadCount++)}},watch:{vsrc:function(e,t){this.myFunction()},upload_type:function(){this.$emit("upload_type_change",this.upload_type)}},mounted:function(){},head:function(){return{link:[{href:"/admin/css/up_video.css",type:"text/css",rel:"stylesheet"}],script:[{src:"/admin/js/es6-promise.min.js"},{src:"/admin/js/aliyun-oss-sdk4.13.2.min.js"},{src:"/admin/js/aliyun-upload-sdk1.3.1.min.js"},{src:"/admin/js/bootstrap.min.js"}]}}}},o1tr:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o("TxpG"),s=o.n(a);for(var i in a)"default"!==i&&function(e){o.d(t,e,function(){return a[e]})}(i);var n=o("DUAh"),l=!1;var d=function(e){l||o("qL/W")},u=o("VU/8")(s.a,n.a,!1,d,"data-v-4d6f5a6e",null);u.options.__file="pages\\admin\\u_video.vue",t.default=u.exports},"qL/W":function(e,t){}});