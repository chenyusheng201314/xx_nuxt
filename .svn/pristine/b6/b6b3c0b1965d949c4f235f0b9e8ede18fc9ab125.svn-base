webpackJsonp([59],{"2YK6":function(e,t){},"9K1q":function(e,t){},FB8n:function(e,t,a){"use strict";var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("input",{style:e.m_style,attrs:{type:"file",id:"upload",value:"多文件上传",multiple:"",accept:e.mime,disabled:!e.upload_type},on:{click:function(t){e.getUpload()}}}),a("div",{directives:[{name:"show",rawName:"v-show",value:e.cover_show,expression:"cover_show"}],staticClass:"up-lists-cover"},[a("div",{staticClass:"cover-con"},[a("h3",[e._v("上传列表")]),a("ul",e._l(e.upload_item,function(t,s){return a("li",{key:s},[e._m(0,!0),a("div",{staticClass:"upload_name"},[a("p",[e._v(e._s(t.name))]),a("p",[e._v(e._s(e._f("b_to_mb")(t.pro_size))+"MB / "+e._s(e._f("b_to_mb")(t.size))+"MB")])]),a("div",{staticClass:"upload_process"},[a("div",{staticClass:"upload_process_in",style:{width:t.process}})]),a("div",{staticClass:"upload_percent"},[e._v(e._s(t.process))]),a("div",{staticClass:"upload_status"},[a("span",{staticClass:"badge",class:{badge_info_b:0===t.state,badge_primary_b:1===t.state,badge_warning_b:2===t.state,badge_success_b:3===t.state}},[e._v(e._s(0===t.state?"等待中":1===t.state?"上传中":2===t.state?"已暂停":"已完成"))])]),a("div",{staticClass:"upload_control"},[a("i",{directives:[{name:"show",rawName:"v-show",value:1===t.state,expression:"item.state=== 1"}],staticClass:"iconfont",attrs:{"data-toggle":"tooltip","data-placement":"top","data-original-title":"暂停"},on:{click:function(a){e.upload_stop(t.uploader,s)}}},[e._v("")]),a("i",{directives:[{name:"show",rawName:"v-show",value:2===t.state,expression:"item.state===2"}],staticClass:"iconfont",attrs:{"data-toggle":"tooltip","data-placement":"top","data-original-title":"恢复上传"},on:{click:function(a){e.upload_start(t.uploader,s)}}},[e._v("")])])])})),a("div",{staticClass:"remove-list",on:{click:function(t){e.close_cover(!1)}}},[e._v("收起上传列表")])])])])};s._withStripped=!0;var o={render:s,staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"icon"},[t("img",{attrs:{src:"/company_manage/images/class/icon-video.png",alt:""}})])}]};t.a=o},GScf:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a("o2NT"),function(e){return e&&e.__esModule?e:{default:e}}(a("/5sW")).default.filter("b_to_mb",function(e){return(e/1024/1024).toFixed(2)}),t.default={name:"up_video",layout:"companyManage",props:["mime","m_style","cover_show"],data:function(){return{vsrc:"",vsrc1:"",vsrc_t:"",vsrc_t1:"",upload_item:[],upload_control_item:[],upload_vedio_nums:0,upload_index:0,upload_index_a:0,uploadCount:0,upload_type:!0}},methods:{myFunction:function(e,t){console.log("myFunction",e),console.log("565656",this.vsrc_t)},get_voucher:function(e,t,a,s){var o;return jQuery.ajax({url:this.$store.state.company.baseUrl+"/common/video/create_upload",type:"POST",dataType:"json",headers:{token:this.$store.state.company.token},async:!1,data:{title:e,filename:t,filesize:a,description:"",coverurl:"",cateid:s,tags:""},success:function(e){o=e}}),o},update_voucher:function(e){jQuery.ajax({url:this.$store.state.company.baseUrl+"/common/video/refresh_upload",type:"POST",dataType:"json",headers:{token:this.$store.state.company.token},data:{videoid:e},success:function(e){}})},create_uploader:function(e,t,a,s,o,n){var i=this,l=new AliyunUpload.Vod({partSize:1048576,parallel:5,retryCount:3,retryDuration:2,onUploadstarted:function(o){i.upload_item[s].state=1,i.upload_vedio_nums++,i.$emit("video_list_type_change",!0),console.log("开始上传了......"),i.upload_type=!1,i.close_cover(!0),l.setUploadAuthAndAddress(o,e,t,a)},onUploadSucceed:function(e){i.upload_item[s].state=3,i.upload_vedio_nums--;var t=e.file.name,n=e.file.type.split("/")[1];i.update_upload_item(),console.log("完成",e),jQuery.ajax({url:i.$store.state.company.baseUrl+"/company/company_video/video_add",type:"POST",dataType:"json",headers:{token:i.$store.state.company.token},data:{upload_name:t,video_id:a,size:o,duration:0,video_type:n},success:function(e){console.log(t+"已经保存成功")}})},onUploadFailed:function(e,t,a){console.log("你倒霉了，上传失败了......"),console.log("onUploadFailed: file:"+e.file.name+",code:"+t+", message:"+a)},onUploadProgress:function(e,t,a){i.upload_item[s].process=Math.ceil(100*a)+"%",i.upload_item[s].pro_size=Math.ceil(100*a)/100*i.upload_item[s].size,console.log("上传进度",Math.ceil(100*a)+"%")},onUploadTokenExpired:function(e){console.log("上传凭证超时了......"),console.log("onUploadTokenExpired"),this.update_voucher(a)},onUploadEnd:function(e){var t=1;i.upload_item.forEach(function(e,a){3===e.state?t=0:t++}),console.log(t),0===t&&(console.log("上传已经全部结束了......"),i.upload_type=!0,window.location.reload())}});return l},add_file:function(e,t){e.addFile(t,null,null,null,null)},delete_file:function(e,t){e.deleteFile(t)},cancle_file:function(e,t){e.cancelFile(0)},resume_file:function(e,t){e.resumeFile(0)},get_file_lists:function(e){e.listFiles();for(var t=e.listFiles(),a=0;a<t.length;a++)log("file:"+t[a].file.name+", status:"+t[a].state+", endpoint:"+t[a].endpoint+", bucket:"+t[a].bucket+", object:"+t[a].object)},clear_file_lists:function(e){e.cleanList()},upload_start:function(e,t){this.upload_vedio_nums<1&&(e.startUpload(),this.upload_item[t].state=1)},upload_stop:function(e,t){this.upload_item[t].state=2,e.stopUpload(),this.upload_vedio_nums--,this.update_upload_item()},resumeUploadWithAuth:function(e){e.resumeUploadWithAuth(uploadAuth)},setUploadAuthAndAddress:function(e){e.setUploadAuthAndAddress(uploadInfo,uploadAuth,uploadAddress,videoId)},update_upload_item:function(){for(var e=0;e<this.upload_control_item.length;e++)0==this.upload_control_item[e].state&&this.upload_start(this.upload_control_item[e].uploader,e)},close_cover:function(e){this.$emit("close_cover",e)},getUpload:function(){var e,t=this,a=$,s="";console.log(t.upload_type),t.upload_type&&(0==this.uploadCount&&document.getElementById("upload").addEventListener("change",function(o){for(var n=0,i=0,l=0;l<o.target.files.length;l++)if("video"===o.target.files[l].type.split("/")[0]?i+=0:i++,0===i){(new FileReader).onloadend=function(e){t.vsrc=e.target.result},console.log("文件属性",o.target.files[l]),s=t.get_voucher(o.target.files[l].name,o.target.files[l].name,o.target.files[l].size,768542560);var r=t.create_uploader(s.data.UploadAuth,s.data.UploadAddress,s.data.VideoId,t.upload_index_a,o.target.files[l].size,t.vsrc_t);t.add_file(r,o.target.files[l]),e={uploader:r,name:o.target.files[l].name,pro_size:"",size:o.target.files[l].size,process:0,state:0},t.upload_item.push(e),t.upload_control_item.push(e),n++,t.upload_index_a++}else t.$message.error("上传文件类型错误!");if(a("#file_prosess").modal("toggle"),n>1)t.upload_start(t.upload_control_item[t.upload_index].uploader,t.upload_index),t.upload_index++;else for(var c=0;c<n;c++)t.upload_start(t.upload_control_item[t.upload_index].uploader,t.upload_index),t.upload_index++}),t.uploadCount++)}},watch:{vsrc:function(e,t){this.myFunction()},upload_type:function(){this.$emit("upload_type_change",this.upload_type)}},head:function(){return{script:[{src:"/company_manage/js/es6-promise.min.js"},{src:"/company_manage/js/aliyun-oss-sdk4.13.2.min.js"},{src:"/company_manage/js/aliyun-upload-sdk1.3.1.min.js"},{src:"/company_manage/js/bootstrap.min.js"}]}}}},SkLZ:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("sZZ6"),o=a.n(s);for(var n in s)"default"!==n&&function(e){a.d(t,e,function(){return s[e]})}(n);var i=a("jL+g"),l=!1;var r=function(e){l||a("2YK6")},c=a("VU/8")(o.a,i.a,!1,r,"data-v-dade9ebc",null);c.options.__file="pages\\company_manage\\index\\video.vue",t.default=c.exports},c5hs:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("GScf"),o=a.n(s);for(var n in s)"default"!==n&&function(e){a.d(t,e,function(){return s[e]})}(n);var i=a("FB8n"),l=!1;var r=function(e){l||a("9K1q")},c=a("VU/8")(o.a,i.a,!1,r,"data-v-77570c99",null);c.options.__file="components\\companyManage\\up_video.vue",t.default=c.exports},"jL+g":function(e,t,a){"use strict";var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"company-video"},[a("h2",[e._v("视频库")]),a("p",{staticClass:"eng-name"},[e._v("Video library")]),a("div",{directives:[{name:"show",rawName:"v-show",value:e.btn_show,expression:"btn_show"}],staticClass:"update-list",on:{click:e.show_up_list}},[e._v("视频传输列表")]),a("ul",{staticClass:"search-info"},[a("li",[a("span",{staticClass:"li-span"},[e._v("视频名称")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.search_info.name,expression:"search_info.name"}],attrs:{type:"text"},domProps:{value:e.search_info.name},on:{input:function(t){t.target.composing||e.$set(e.search_info,"name",t.target.value)}}})]),a("li",[a("span",{staticClass:"li-span"},[e._v("上传时间")]),a("el-date-picker",{attrs:{type:"datetimerange","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss","default-time":["00:00:00","23:59:59"]},model:{value:e.search_info.time,callback:function(t){e.$set(e.search_info,"time",t)},expression:"search_info.time"}})],1),a("li",[a("span",{staticClass:"li-span"},[e._v("是否被使用")]),a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.search_info.status,callback:function(t){e.$set(e.search_info,"status",t)},expression:"search_info.status"}},e._l(e.search_info.status_select,function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.num}})}))],1),a("li",{staticClass:"last-li"},[a("span",{staticClass:"search-btn",on:{click:e.get_list}},[e._v("搜索")]),a("span",{staticClass:"add-btn",class:{disable_btn:!e.up_type},on:{click:e.add_err}},[e._v("\n       "+e._s(e.up_type?"+ 上传":"上传中...")+"\n        "),a("upVideo",{directives:[{name:"show",rawName:"v-show",value:e.up_show,expression:"up_show"}],attrs:{m_style:"opacity: 0;position: absolute;top: 0;left: 0;width: 90px;height: 40px;",mime:"",cover_show:e.cover_show},on:{close_cover:e.close_cover,get_list_again:e.get_list_again,video_list_type_change:e.video_list_type_change,upload_type_change:e.upload_type_change}})],1),a("span",{staticClass:"sm"},[e._v("视频仅供您企业内部使用")])])]),a("table",[e._m(0),a("tbody",e._l(e.video_list,function(t,s){return a("tr",{key:s},[a("td",{attrs:{width:"100"}},[e._v(e._s(s+1))]),a("td",{attrs:{width:"550"}},[a("p",{staticClass:"p1"},[e._v(e._s(t.upload_name))])]),a("td",{attrs:{width:"150"}},[e._v(e._s((t.duration/60).toFixed(1))+" 分钟")]),a("td",{attrs:{width:"150"}},[e._v(e._s(t.video_type))]),a("td",{attrs:{width:"350"}},[e._v(e._s(t.created_at))]),a("td",{attrs:{width:"100"}},[a("span",{directives:[{name:"show",rawName:"v-show",value:0!==t.is_used,expression:"item.is_used !== 0"}],staticClass:"true"},[e._v("是")]),a("span",{directives:[{name:"show",rawName:"v-show",value:0===t.is_used,expression:"item.is_used === 0"}],staticClass:"false"},[e._v("否")])]),a("td",[a("span",{staticClass:"iconfont",on:{click:function(a){e.delete_one(s,t.id)}}},[e._v("")]),a("span",{staticClass:"iconfont",attrs:{title:"更新视频时长"},on:{click:function(a){e.update_time(s,t.video_id)}}},[e._v("")])])])}))]),a("div",{staticClass:"paging"},[a("el-pagination",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],attrs:{"current-page":e.paging.currentPage,"page-sizes":e.paging.page_sizes,"page-size":e.paging.page_size,layout:"prev, pager, next, sizes, jumper",total:e.paging.total,"pager-count":5},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange,"update:currentPage":function(t){e.$set(e.paging,"currentPage",t)}}})],1)])};s._withStripped=!0;var o={render:s,staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("tr",[t("th",[this._v("序号")]),t("th",[this._v("视频名称")]),t("th",[this._v("时长")]),t("th",[this._v("类型")]),t("th",[this._v("上传时间")]),t("th",[this._v("是否被使用")]),t("th",[this._v("操作")])])}]};t.a=o},o2NT:function(e,t){},sZZ6:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=i(a("Xxa5")),o=i(a("exGp")),n=i(a("c5hs"));function i(e){return e&&e.__esModule?e:{default:e}}t.default={name:"video_library",layout:"companyManage",components:{upVideo:n.default},data:function(){return{search_info:{name:"",time:"",status:"",status_select:[{num:"",name:"全部"},{num:1,name:"是"},{num:0,name:"否"}]},fullscreenLoading:!1,cover_show:!1,up_type:!0,btn_show:!1,up_show:!0,tit:"测试标题"}},asyncData:function(){var e=(0,o.default)(s.default.mark(function e(t){var a,o,n=t.store;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a={url:"/company/company_video/video_list",data:{page:1,psize:20,is_used:"",video_id:"",show_name:"",create_start_time:"",create_end_time:""}},e.next=3,n.dispatch("companyHttpGet",a);case 3:return o=e.sent,e.abrupt("return",{video_list:o.data.data.data,paging:{total:o.data.data.total,currentPage:1,page_sizes:[10,20,30],page_size:20}});case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),methods:{get_list:function(){var e=(0,o.default)(s.default.mark(function e(){var t,a,o;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(t=this).fullscreenLoading=!0,a={url:"/company/company_video/video_list",data:{page:t.paging.currentPage,psize:t.paging.page_size,is_used:t.search_info.status,video_id:"",show_name:t.search_info.name,create_start_time:t.search_info.time?t.search_info.time[0]:"",create_end_time:t.search_info.time?t.search_info.time[1]:""}},e.next=5,t.$store.dispatch("companyHttpGet",a);case 5:(o=e.sent)&&(t.fullscreenLoading=!1),t.video_list=o.data.data.data;case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),handleSizeChange:function(e){this.paging.page_size=e,this.get_list()},handleCurrentChange:function(e){this.paging.currentPage=e,this.get_list()},delete_one:function(e,t){var a=this,n=this;if(!n.comsys.adminCheckRole(n.$store.state.company.companyRole.data,"company_video","video_del"))return this.$message({message:"警告，您无此权限",type:"warning"}),!1;0===parseInt(n.video_list[e].is_used)?n.$confirm("此操作将永久删除该视频, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((0,o.default)(s.default.mark(function e(){var o,i;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o={url:"/company/company_video/video_del",data:{id:t}},e.next=3,n.$store.dispatch("companyHttpPost",o);case 3:i=e.sent,console.log(i),0===i.code?(n.$message({type:"success",message:"删除成功!"}),n.get_list()):n.$message.error(i.message);case 6:case"end":return e.stop()}},e,a)}))).catch(function(){n.$message({type:"info",message:"已取消删除"})}):n.$message.error("被使用中的视频无法删除")},show_up_list:function(){this.cover_show=!0},close_cover:function(e){this.cover_show=e},get_list_again:function(e){this.cover_show=!1,e&&this.video_paging()},upload_type_change:function(e){this.up_type=e},video_list_type_change:function(e){this.btn_show=e},update_time:function(){var e=(0,o.default)(s.default.mark(function e(t,a){var o,n,i;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=this,0!==parseInt(o.video_list[t].duration)){e.next=10;break}return n={url:"/common/video/company_video_duration_save",data:{videoid:a}},e.next=5,o.$store.dispatch("companyHttpPost",n);case 5:i=e.sent,console.log("视频时长",i),0===i.code?(o.$message({type:"success",message:"更新成功!"}),o.video_list[t].duration=i.data):o.$message({type:"warning",message:"视频拼命保存中，请稍等片刻!"}),e.next=11;break;case 10:o.$message({type:"warning",message:"已是最新数据，无需更新!"});case 11:case"end":return e.stop()}},e,this)}));return function(t,a){return e.apply(this,arguments)}}(),add_err:function(){this.up_show||this.$message({message:"警告，您无此权限",type:"warning"})}},mounted:function(){var e=this.comsys.adminCheckRole(this.$store.state.company.companyRole.data,"company_video","video_add");this.up_show=e},head:function(){return{title:"视频库",link:[{href:"/company_manage/css/iconfont.css",type:"text/css",rel:"stylesheet"},{href:"/company_manage/css/video.css",type:"text/css",rel:"stylesheet"}],script:[{src:"/company_manage/js/es6-promise.min.js"},{src:"/company_manage/js/aliyun-oss-sdk4.13.2.min.js"},{src:"/company_manage/js/aliyun-upload-sdk1.3.1.min.js"},{src:"/company_manage/js/bootstrap.min.js"}]}}}}});