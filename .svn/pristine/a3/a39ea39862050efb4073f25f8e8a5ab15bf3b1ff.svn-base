webpackJsonp([97],{CuSC:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(a("Xxa5")),s=o(a("exGp"));function o(e){return e&&e.__esModule?e:{default:e}}t.default={name:"account",layout:"companyManage",data:function(){return{search_info:{name:"",accound:"",time:[]},fullscreenLoading:!1,cover_type:1,cover_show:!1,now_account_id:""}},asyncData:function(){var e=(0,s.default)(n.default.mark(function e(t){var a,s,o,c,i=t.store;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a={url:"/company/company_user/list",data:{page:1,psize:20,realname:"",mobile:"",start_time:"",end_time:""}},e.next=3,i.dispatch("companyHttpGet",a);case 3:return s=e.sent,o={url:"/company/acl/role_list",data:{role_name:"",start_time:"",end_time:"",page:1,psize:999999,role:1}},e.next=7,i.dispatch("companyHttpGet",o);case 7:return c=e.sent,e.abrupt("return",{show_lists:s.data.data,paging:{total:s.data.total,currentPage:1,page_sizes:[10,20,30],page_size:20},account_info:{account:"",id:"",pwd:"",name:"",role_select:c.data.data,role:"",status_select:[{id:1,name:"正常"},{id:0,name:"冻结"}],status:1}});case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),methods:{get_list:function(){var e=(0,s.default)(n.default.mark(function e(){var t,a,s;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(t=this).fullscreenLoading=!0,a={url:"/company/company_user/list",data:{page:t.paging.currentPage,psize:t.paging.page_size,realname:t.search_info.name,mobile:t.search_info.accound,start_time:t.search_info.time?t.search_info.time[0]:"",end_time:t.search_info.time?t.search_info.time[1]:""}},e.next=5,t.$store.dispatch("companyHttpGet",a);case 5:(s=e.sent)&&(t.fullscreenLoading=!1),t.show_lists=s.data.data;case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),handleSizeChange:function(e){this.paging.page_size=e,this.get_list()},handleCurrentChange:function(e){this.paging.currentPage=e,this.get_list()},change_type:function(e,t){if(1===e){if(!this.comsys.adminCheckRole(this.$store.state.company.companyRole.data,"company_user","add"))return this.$message({message:"警告，您无此权限",type:"warning"}),!1;this.cover_show=!0,this.cover_type=parseInt(e),this.account_info.account="",this.account_info.pwd="",this.account_info.name="",this.account_info.role=""}else if(2===e){if(!this.comsys.adminCheckRole(this.$store.state.company.companyRole.data,"company_user","add"))return this.$message({message:"警告，您无此权限",type:"warning"}),!1;this.cover_show=!0,this.cover_type=parseInt(e),this.now_account_id=t.id,this.account_info.id=t.id,this.account_info.account=t.mobile,this.account_info.name=t.realname,this.account_info.status=t.status,this.account_info.role=t.company_user_acl_role?t.company_user_acl_role.role_id:"",this.account_info.pwd="******"}else 3===e&&(this.cover_show=!0,this.cover_type=parseInt(e),this.account_info.id=t.company_id,this.account_info.account=t.mobile,this.account_info.name=t.realname,this.account_info.status=t.status,this.account_info.role=t.company_user_acl_role?t.company_user_acl_role.role_id:"",this.account_info.pwd="******")},delete_one:function(e){var t=this,a=this;if(console.log(e),!a.comsys.adminCheckRole(a.$store.state.company.companyRole.data,"company_user","del"))return this.$message({message:"警告，您无此权限",type:"warning"}),!1;a.$confirm("此操作将永久删除该账户, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((0,s.default)(n.default.mark(function s(){var o,c;return n.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return o={url:"/company/company_user/del",data:{id:e.id}},t.next=3,a.$store.dispatch("companyHttpPost",o);case 3:c=t.sent,console.log(c),0===c.code&&(a.$message({type:"success",message:"删除成功!"}),a.cover_show=!1,a.get_list());case 6:case"end":return t.stop()}},s,t)}))).catch(function(){a.$message({type:"info",message:"已取消删除"})})},add_save:function(){var e=(0,s.default)(n.default.mark(function e(){var t,a,s,o;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=/^[0-9]*$/,!((t=this).account_info.account&&t.account_info.pwd&&t.account_info.name&&t.account_info.role)){e.next=19;break}if(a.test(t.account_info.account)){e.next=7;break}t.$message.error("请输入正确的账户格式!"),e.next=17;break;case 7:if(!(t.account_info.pwd.length<6)){e.next=11;break}t.$message.error("密码不得少于六位数!"),e.next=17;break;case 11:return s={url:"/company/company_user/add",data:{id:t.account_info.id,mobile:t.account_info.account,password:"******"===t.account_info.pwd?"":t.account_info.pwd,realname:t.account_info.name,status:t.account_info.status,role_id:t.account_info.role}},e.next=14,t.$store.dispatch("companyHttpPost",s);case 14:o=e.sent,console.log(o),0===o.code?(t.$message({type:"success",message:"保存成功!"}),t.cover_show=!1,t.get_list()):t.$message.error(o.message);case 17:e.next=20;break;case 19:t.$message.error("信息请填写完整!");case 20:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},mounted:function(){console.log("token",this.$store.state.company.token),console.log("ss",this.show_lists)},head:function(){return{title:"员工账户",link:[{href:"/company_manage/css/iconfont.css",type:"text/css",rel:"stylesheet"},{href:"/company_manage/css/account.css",type:"text/css",rel:"stylesheet"}]}}}},JYpu:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("CuSC"),s=a.n(n);for(var o in n)"default"!==o&&function(e){a.d(t,e,function(){return n[e]})}(o);var c=a("cJFm"),i=!1;var r=function(e){i||a("TaKB")},l=a("VU/8")(s.a,c.a,!1,r,"data-v-65927594",null);l.options.__file="pages\\company_manage\\index\\account.vue",t.default=l.exports},TaKB:function(e,t){},cJFm:function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"company-account"},[a("h2",[e._v("员工账号")]),a("p",{staticClass:"eng-name"},[e._v("Employee account number")]),a("ul",{staticClass:"search-info"},[a("li",[a("span",{staticClass:"li-span"},[e._v("姓名")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.search_info.name,expression:"search_info.name"}],attrs:{type:"text"},domProps:{value:e.search_info.name},on:{input:function(t){t.target.composing||e.$set(e.search_info,"name",t.target.value)}}})]),a("li",[a("span",{staticClass:"li-span"},[e._v("账号")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.search_info.accound,expression:"search_info.accound"}],attrs:{type:"text "},domProps:{value:e.search_info.accound},on:{input:function(t){t.target.composing||e.$set(e.search_info,"accound",t.target.value)}}})]),a("li",[a("span",{staticClass:"li-span"},[e._v("创建时间")]),a("el-date-picker",{attrs:{type:"datetimerange","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss","default-time":["00:00:00","23:59:59"]},model:{value:e.search_info.time,callback:function(t){e.$set(e.search_info,"time",t)},expression:"search_info.time"}})],1),a("li",{staticClass:"last"},[a("span",{staticClass:"search-btn",on:{click:e.get_list}},[e._v("搜索")]),a("span",{staticClass:"add-btn",on:{click:function(t){e.change_type(1)}}},[e._v("+ 创建账号")])])]),a("table",[e._m(0),a("tbody",e._l(e.show_lists,function(t,n){return a("tr",{key:n},[a("td",{attrs:{width:"120"}},[e._v(e._s(n+1))]),a("td",{attrs:{width:"200"}},[e._v(e._s(t.realname))]),a("td",{attrs:{width:"230"}},[e._v(e._s(t.mobile))]),a("td",{attrs:{width:"170"}},[e._v(e._s(t.company_user_acl_role?t.company_user_acl_role.role_name:"--"))]),a("td",{attrs:{width:"250"}},[e._v(e._s(null===t.created_at||""===t.created_at?"--":t.created_at))]),a("td",{attrs:{width:"250"}},[e._v(e._s(null===t.last_login_time?"--":t.last_login_time))]),a("td",[a("span",{staticClass:"iconfont",on:{click:function(a){e.change_type(3,t)}}},[e._v("")]),a("span",{directives:[{name:"show",rawName:"v-show",value:0===t.is_admin,expression:"item.is_admin === 0"}],staticClass:"iconfont",on:{click:function(a){e.change_type(2,t)}}},[e._v("")]),a("span",{directives:[{name:"show",rawName:"v-show",value:0===t.is_admin,expression:"item.is_admin === 0"}],staticClass:"iconfont",on:{click:function(a){e.delete_one(t)}}},[e._v("")])])])}))]),a("div",{staticClass:"paging"},[a("el-pagination",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],attrs:{"current-page":e.paging.currentPage,"page-sizes":e.paging.page_sizes,"page-size":e.paging.page_size,layout:"prev, pager, next, sizes, jumper",total:e.paging.total,"pager-count":5},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange,"update:currentPage":function(t){e.$set(e.paging,"currentPage",t)}}})],1),a("el-dialog",{attrs:{title:1===e.cover_type?"创建账号":2===e.cover_type?"编辑账号":"查看",visible:e.cover_show,"close-on-click-modal":!1,width:"40%"},on:{"update:visible":function(t){e.cover_show=t}}},[a("div",{staticClass:"cover-con"},[a("ul",[a("li",[a("span",{staticClass:"li-name"},[a("label",[e._v("*")]),e._v("账号")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.account_info.account,expression:"account_info.account"}],attrs:{type:"text",disabled:3===e.cover_type,maxlength:"11",placeholder:"请输入11位手机号"},domProps:{value:e.account_info.account},on:{input:function(t){t.target.composing||e.$set(e.account_info,"account",t.target.value)}}})]),a("li",[a("span",{staticClass:"li-name"},[a("label",[e._v("*")]),e._v("密码")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.account_info.pwd,expression:"account_info.pwd"}],attrs:{type:"text",disabled:3===e.cover_type,maxlength:"16"},domProps:{value:e.account_info.pwd},on:{input:function(t){t.target.composing||e.$set(e.account_info,"pwd",t.target.value)}}})]),a("li",[a("span",{staticClass:"li-name"},[a("label",[e._v("*")]),e._v("姓名")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.account_info.name,expression:"account_info.name"}],attrs:{type:"text",disabled:3===e.cover_type,maxlength:"5"},domProps:{value:e.account_info.name},on:{input:function(t){t.target.composing||e.$set(e.account_info,"name",t.target.value)}}})]),a("li",[a("span",{staticClass:"li-name"},[a("label",[e._v("*")]),e._v("账号状态")]),a("el-select",{attrs:{placeholder:"请选择",disabled:3===e.cover_type},model:{value:e.account_info.status,callback:function(t){e.$set(e.account_info,"status",t)},expression:"account_info.status"}},e._l(e.account_info.status_select,function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.id}})}))],1),a("li",[a("span",{staticClass:"li-name"},[a("label",[e._v("*")]),e._v("角色")]),a("el-select",{attrs:{placeholder:"请选择",disabled:3===e.cover_type},model:{value:e.account_info.role,callback:function(t){e.$set(e.account_info,"role",t)},expression:"account_info.role"}},e._l(e.account_info.role_select,function(e,t){return a("el-option",{key:t,attrs:{label:e.role_name,value:e.role_id}})}))],1)]),a("div",{directives:[{name:"show",rawName:"v-show",value:1===e.cover_type,expression:"cover_type === 1"}],staticClass:"add-save",on:{click:e.add_save}},[e._v("保存")]),a("div",{directives:[{name:"show",rawName:"v-show",value:2===e.cover_type,expression:"cover_type === 2"}],staticClass:"edit"},[a("span",{staticClass:"edit-save",on:{click:e.add_save}},[e._v("保存")])])])])],1)};n._withStripped=!0;var s={render:n,staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("tr",[t("th",[this._v("序号")]),t("th",[this._v("姓名")]),t("th",[this._v("账号")]),t("th",[this._v("角色")]),t("th",[this._v("创建时间")]),t("th",[this._v("最后登录时间")]),t("th",[this._v("操作")])])}]};t.a=s}});