webpackJsonp([61],{"5iU6":function(e,s,t){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var a=t("NmLy"),i=t.n(a);for(var n in a)"default"!==n&&function(e){t.d(s,e,function(){return a[e]})}(n);var o=t("wOJ4"),r=!1;var c=function(e){r||t("aM2x")},l=t("VU/8")(i.a,o.a,!1,c,"data-v-a98533ee",null);l.options.__file="pages\\admin\\role.vue",s.default=l.exports},H8Uz:function(e,s,t){"use strict";var a=function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",{staticClass:"left_nav"},[t("ul",e._l(e.data,function(s,a){return t("li",{key:a,class:{active:s.active},on:{click:function(s){e.nav_choose(a)}}},[e._v("\n      "+e._s(s.name)+"\n    ")])}))])};a._withStripped=!0;var i={render:a,staticRenderFns:[]};s.a=i},NmLy:function(e,s,t){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var a=r(t("Xxa5")),i=r(t("exGp")),n=r(t("cJuq")),o=r(t("mtWM"));function r(e){return e&&e.__esModule?e:{default:e}}s.default={layout:"admin",name:"role",components:{LeftNav:n.default},data:function(){return{fullscreenLoading:!1,leftNav:[],isSee:!1,search_info:{name:"",time:[]},cover_show:!1,add_user:{name:"",isChoose_list:[]}}},asyncData:function(){var e=(0,i.default)(a.default.mark(function e(s){var t,i,n,o,r,c=s.store;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=function e(s){s.forEach(function(t,a){t.isChoose=!1,t.son&&(s=t.son,e(s))})},t={url:"/manage/acl/role_list",data:{page:1,psize:20,role_name:"",start_time:"",end_time:""}},e.next=4,c.dispatch("adminHttpGet",t);case 4:return i=e.sent,n={url:"/manage/acl/privilege_list",data:{token:c.state.admin.token}},e.next=8,c.dispatch("adminHttpGet",n);case 8:return o=e.sent,console.log("权限树",o),r(o.data),e.abrupt("return",{role_lists:i.data.data,role_id:"",paging:{total:i.data.total,currentPage:1,page_sizes:[10,20,30],page_size:20},jurisdiction:o.data,role_tit:"创建角色"});case 12:case"end":return e.stop()}},e,this)}));return function(s){return e.apply(this,arguments)}}(),methods:{_paging:function(){var e=(0,i.default)(a.default.mark(function e(){var s,t,i;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(s=this).fullscreenLoading=!0,t={url:"/manage/acl/role_list",data:{page:s.paging.currentPage,psize:s.paging.page_size,role_name:s.search_info.name,start_time:s.search_info.time?s.search_info.time[0]:"",end_time:s.search_info.time?s.search_info.time[1]:""}},e.next=5,s.$store.dispatch("adminHttpGet",t);case 5:i=e.sent,console.log(i),i&&(s.fullscreenLoading=!1),s.role_lists=i.data.data,s.paging.total=i.data.total;case 10:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),handleSizeChange:function(e){this.paging.page_size=e,this.paging.currentPage=1,this._paging()},handleCurrentChange:function(e){this.paging.currentPage=e,this._paging()},search:function(){this._paging()},choose:function(){var e=this,s=arguments[1],t=arguments[2],a=arguments[3],i=arguments[4],n=arguments[0];function o(){var t=0;$.each(e.jurisdiction[s].son,function(a,i){i.isChoose?t++:t+=0,0!==t&&(e.jurisdiction[s].isChoose=!0)})}function r(){var a=0;$.each(e.jurisdiction[s].son[t].son,function(i,n){n.isChoose?a++:a+=0,0!==a&&(e.jurisdiction[s].son[t].isChoose=!0)})}switch(arguments.length){case 2:e.jurisdiction[s].isChoose=n,e.jurisdiction[s].son?c(e.jurisdiction[s].son,n):e.jurisdiction[s].isChoose=n;break;case 3:e.jurisdiction[s].son[t].isChoose=n,e.jurisdiction[s].son[t].son?c(e.jurisdiction[s].son[t].son,n):e.jurisdiction[s].son[t].isChoose=n,o();break;case 4:e.jurisdiction[s].son[t].son[a].isChoose=n,e.jurisdiction[s].son[t].son[a].son?c(e.jurisdiction[s].son[t].son[a].son,n):e.jurisdiction[s].son[t].son[a].isChoose=n,r(),o();break;case 5:e.jurisdiction[s].son[t].son[a].son[i].isChoose=n,function(){var i=0;$.each(e.jurisdiction[s].son[t].son[a].son,function(n,o){o.isChoose?i++:i+=0,0!==i&&(e.jurisdiction[s].son[t].son[a].isChoose=!0)})}(),r(),o()}function c(e,s){e.forEach(function(t,a){t.isChoose=s,t.son&&c(e=t.son,s)})}},close_cover:function(){this.cover_show=!1},add_role:function(){if(!this.comsys.adminCheckRole(this.$store.state.admin.adminRole.data,"acl","role_add"))return this.$message({message:"警告，您无此权限",type:"warning"}),!1;this.role_tit="创建角色",this.cover_show=!0,this.role_id="",this.isSee=!1,this.add_user.name="",function e(s){$.each(s,function(t,a){a.isChoose=!1,a.son&&(s=a.son,e(s))})}(this.jurisdiction)},user_edit:function(){var e=(0,i.default)(a.default.mark(function e(s){var t;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this,this.comsys.adminCheckRole(this.$store.state.admin.adminRole.data,"acl","role_add")){e.next=5;break}return this.$message({message:"警告，您无此权限",type:"warning"}),e.abrupt("return",!1);case 5:t.user_see(s),t.role_tit="角色编辑",t.isSee=!1,t.role_id=t.role_lists[s].role_id;case 9:case"end":return e.stop()}},e,this)}));return function(s){return e.apply(this,arguments)}}(),user_see:function(){var e=(0,i.default)(a.default.mark(function e(s){var t,i,n,o;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this,this.comsys.adminCheckRole(this.$store.state.admin.adminRole.data,"acl","role_info")){e.next=7;break}return this.$message({message:"警告，您无此权限",type:"warning"}),e.abrupt("return",!1);case 7:return t.role_tit="查看角色",i=t.role_lists[s].role_id,t.add_user.isChoose_list=[],t.add_user.name="",t.cover_show=!0,t.fullscreenLoading=!0,t.isSee=!0,t.add_user.name=t.role_lists[s].role_name,n={url:"/manage/acl/role_info",data:{role_id:i}},e.next=18,t.$store.dispatch("adminHttpGet",n);case 18:0===(o=e.sent).code&&(t.fullscreenLoading=!1,t.get_id(o.data),t.set_choose(t.jurisdiction));case 20:case"end":return e.stop()}},e,this)}));return function(s){return e.apply(this,arguments)}}(),get_id:function(e){var s=this;$.each(e,function(t,a){-1===s.add_user.isChoose_list.indexOf(a.privilege_id)&&s.add_user.isChoose_list.push(a.privilege_id),a.son&&(e=a.son,s.get_id(e))})},set_choose:function(e){var s=this;$.each(e,function(t,a){-1!==s.add_user.isChoose_list.indexOf(a.privilege_id)?a.isChoose=!0:a.isChoose=!1,a.son&&(e=a.son,s.set_choose(e))})},delete_one:function(e,s){var t=this,n=this;if(!this.comsys.adminCheckRole(this.$store.state.admin.adminRole.data,"acl","role_del"))return this.$message({message:"警告，您无此权限",type:"warning"}),!1;s.length>0?n.$message.error("该角色下已有账号，不可删除!"):n.$confirm("此操作将永久删除该角色, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((0,i.default)(a.default.mark(function s(){var i,o;return a.default.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return console.log(1111),i={url:"/manage/acl/role_del",data:{role_id:e}},s.next=4,n.$store.dispatch("adminHttpPost",i);case 4:o=s.sent,console.log("删除",o),0===o.code&&(n.$message({type:"success",message:"删除成功!"}),n._paging());case 7:case"end":return s.stop()}},s,t)}))).catch(function(){n.$message({type:"info",message:"已取消删除"})})},add_one:function(){var e=this;e.add_user.isChoose_list=[],function s(t){$.each(t,function(a,i){i.isChoose&&-1===e.add_user.isChoose_list.indexOf(i.privilege_id)&&e.add_user.isChoose_list.push(i.privilege_id),i.son&&(t=i.son,s(t))})}(e.jurisdiction);var s=this.comssr.validatorLen(e.add_user.name,10);0!==e.add_user.isChoose_list.length&&""!==e.add_user.name&&s?(0,o.default)({url:e.$store.state.admin.baseUrl+"/manage/acl/role_add",method:"post",headers:{token:e.$store.state.admin.token},data:{role_id:e.role_id,role_name:e.add_user.name,role_status:1,privilege_id:e.add_user.isChoose_list.join(",")}}).then(function(s){console.log(s.data),0===s.data.code?(e.$message({message:"保存成功!",type:"success"}),e.cover_show=!1,e.add_user.name="",e.add_user.isChoose_list=[],e.paging.currentPage=1,e.paging.page_size=20,e._paging()):e.$message.error(s.data.message)}).catch(function(e){console.log(e)}):""===e.add_user.name?e.$message.error("必填项不能为空!"):0===e.add_user.isChoose_list.length?e.$message.error("至少选择一个权限!"):s||e.$message.error("角色名称超出限制，限制输入20个字符（10个汉字）")},post_axios:function(){var e=(0,i.default)(a.default.mark(function e(s,t){var i;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=this,e.abrupt("return",(0,o.default)({url:i.$store.state.admin.baseUrl+s,method:"post",headers:{token:i.$store.state.admin.token},data:t}).then(function(e){return e}).catch(function(e){return e}));case 2:case"end":return e.stop()}},e,this)}));return function(s,t){return e.apply(this,arguments)}}(),setMeau:function(){var e=[],s=this.$store.state.admin.adminRole.data,t=this.comsys.adminGetMeau(s,"manage"),a=this.comsys.adminGetMeau(s,"acl"),i=this.comsys.adminGetMeau(s,"log"),n=[],o=[],r=[];t.length>0&&(n=this.comsys.adminGetMeau(t[0].son,"lists")),a.length>0&&(o=this.comsys.adminGetMeau(a[0].son,"role_list")),i.length>0&&(r=this.comsys.adminGetMeau(i[0].son,"list")),n.length>0&&e.push({name:"员工账号",link:"/admin/account",active:!1}),o.length>0&&e.push({name:"角色管理",link:"/admin/role",active:!0}),r.length>0&&e.push({name:"日志",link:"/admin/log",active:!1}),this.leftNav=e}},mounted:function(){this.setMeau()},head:function(){return{title:"基础设置",link:[{href:"/admin/css/role.css",type:"text/css",rel:"stylesheet"}]}}}},aM2x:function(e,s){},cJuq:function(e,s,t){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var a=t("niWl"),i=t.n(a);for(var n in a)"default"!==n&&function(e){t.d(s,e,function(){return a[e]})}(n);var o=t("H8Uz"),r=!1;var c=function(e){r||t("cdzv")},l=t("VU/8")(i.a,o.a,!1,c,null,null);l.options.__file="components\\admin\\LeftNav.vue",s.default=l.exports},cdzv:function(e,s){},niWl:function(e,s,t){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.default={name:"leftNav",props:["data"],data:function(){return{}},methods:{nav_choose:function(e){var s=this;$.each(s.data,function(t,a){t===e?(a.active=!0,console.log(a.name),s.$store.commit("setNav",a.name)):a.active=!1}),this.$router.push({path:s.data[e].link})}},mounted:function(){for(var e in this.data)this.data[e].link==this.$route.path?(this.data[e].active=!0,this.$store.commit("setNav",this.data[e].name)):this.data[e].active=!1},watch:{data:function(e){for(var s in this.data)this.data[s].link==this.$route.path?(this.data[s].active=!0,this.$store.commit("setNav",this.data[s].name)):this.data[s].active=!1}}}},wOJ4:function(e,s,t){"use strict";var a=function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",[t("LeftNav",{attrs:{data:e.leftNav}}),t("div",{staticClass:"admin-role"},[t("h2",[e._v("角色管理")]),t("ul",{staticClass:"role-search"},[t("li",[t("span",[e._v("角色名称")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.search_info.name,expression:"search_info.name"}],staticClass:"inp",attrs:{type:"text"},domProps:{value:e.search_info.name},on:{input:function(s){s.target.composing||e.$set(e.search_info,"name",s.target.value)}}})]),t("li",[t("span",[e._v("创建时间")]),t("el-date-picker",{attrs:{type:"datetimerange","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss","default-time":["00:00:00","23:59:59"]},model:{value:e.search_info.time,callback:function(s){e.$set(e.search_info,"time",s)},expression:"search_info.time"}})],1),t("li",{staticClass:"last-li"},[t("span",{staticClass:"add",on:{click:e.add_role}},[e._v("创建角色")]),t("span",{staticClass:"search",on:{click:e.search}},[e._v("搜索")])])]),t("table",[e._m(0),t("tbody",e._l(e.role_lists,function(s,a){return t("tr",{key:a},[t("td",{attrs:{width:"150px"}},[e._v(e._s(a+1))]),t("td",{attrs:{width:"250px"}},[e._v(e._s(s.role_name))]),t("td",{attrs:{width:"480px"}},[t("p",{staticClass:"p1"},[e._l(s.manage,function(s){return[e._v("\n              "+e._s(s.username)+"\n            ")]})],2)]),t("td",{attrs:{width:"250px"}},[e._v(e._s(s.created_at))]),t("td",{attrs:{width:"350px"}},[t("span",{staticClass:"td-edit",on:{click:function(s){e.user_edit(a)}}},[e._v("编辑")]),t("span",{staticClass:"td-see",on:{click:function(s){e.user_see(a)}}},[e._v("查看")]),t("span",{staticClass:"td-delete",on:{click:function(t){e.delete_one(s.role_id,s.manage)}}},[e._v("删除")])])])}))]),t("div",{staticClass:"paging"},[t("el-pagination",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],attrs:{"current-page":e.paging.currentPage,"page-sizes":e.paging.page_sizes,"page-size":e.paging.page_size,layout:"prev, pager, next, sizes, jumper",total:e.paging.total,"pager-count":5},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange,"update:currentPage":function(s){e.$set(e.paging,"currentPage",s)}}})],1),t("div",{directives:[{name:"show",rawName:"v-show",value:e.cover_show,expression:"cover_show"}],staticClass:"role-cover"},[t("div",{staticClass:"role-con"},[t("span",{staticClass:"close",on:{click:e.close_cover}},[t("img",{attrs:{src:"/admin/images/class/close.png",alt:""}})]),t("h2",[e._v(e._s(e.role_tit))]),t("ul",{staticClass:"add-con"},[t("li",[e._m(1),t("input",{directives:[{name:"model",rawName:"v-model",value:e.add_user.name,expression:"add_user.name"}],attrs:{type:"text",disabled:e.isSee,maxlength:"20"},domProps:{value:e.add_user.name},on:{input:function(s){s.target.composing||e.$set(e.add_user,"name",s.target.value)}}}),t("label",{directives:[{name:"show",rawName:"v-show",value:""===e.add_user.name,expression:"add_user.name === ''"}]},[e._v("必填项不能为空")])]),t("li",[e._m(2),t("div",{staticClass:"jurisdiction"},[t("div",{staticClass:"jurisdiction-all"},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.isSee,expression:"isSee"}],staticClass:"jurisdiction-cover"}),e._l(e.jurisdiction,function(s,a){return t("div",{key:a,staticClass:"p1 p"},[t("img",{directives:[{name:"show",rawName:"v-show",value:!s.isChoose,expression:"!item.isChoose"}],attrs:{src:"/admin/images/role/no-choose.png",alt:""},on:{click:function(s){e.choose(!0,a)}}}),t("img",{directives:[{name:"show",rawName:"v-show",value:s.isChoose,expression:"item.isChoose"}],attrs:{src:"/admin/images/role/choose.png",alt:""},on:{click:function(s){e.choose(!1,a)}}}),t("span",[e._v(e._s(s.privilege_title))]),e._l(s.son,function(i,n){return t("div",{directives:[{name:"show",rawName:"v-show",value:s.son,expression:"item.son"}],key:n,staticClass:"p2 p"},[t("img",{directives:[{name:"show",rawName:"v-show",value:!i.isChoose,expression:"!it2.isChoose"}],attrs:{src:"/admin/images/role/no-choose.png",alt:""},on:{click:function(s){e.choose(!0,a,n)}}}),t("img",{directives:[{name:"show",rawName:"v-show",value:i.isChoose,expression:"it2.isChoose"}],attrs:{src:"/admin/images/role/choose.png",alt:""},on:{click:function(s){e.choose(!1,a,n)}}}),t("span",[e._v(e._s(i.privilege_title))]),e._l(i.son,function(s,o){return t("div",{directives:[{name:"show",rawName:"v-show",value:i.son,expression:"it2.son"}],key:o,staticClass:"p3 p"},[t("img",{directives:[{name:"show",rawName:"v-show",value:!s.isChoose,expression:"!it3.isChoose"}],attrs:{src:"/admin/images/role/no-choose.png",alt:""},on:{click:function(s){e.choose(!0,a,n,o)}}}),t("img",{directives:[{name:"show",rawName:"v-show",value:s.isChoose,expression:"it3.isChoose"}],attrs:{src:"/admin/images/role/choose.png",alt:""},on:{click:function(s){e.choose(!1,a,n,o)}}}),t("span",[e._v(e._s(s.privilege_title))]),e._l(s.son,function(i,r){return t("div",{directives:[{name:"show",rawName:"v-show",value:s.son,expression:"it3.son"}],key:r,staticClass:"p4 p"},[t("img",{directives:[{name:"show",rawName:"v-show",value:!i.isChoose,expression:"!it4.isChoose"}],attrs:{src:"/admin/images/role/no-choose.png",alt:""},on:{click:function(s){e.choose(!0,a,n,o,r)}}}),t("img",{directives:[{name:"show",rawName:"v-show",value:i.isChoose,expression:"it4.isChoose"}],attrs:{src:"/admin/images/role/choose.png",alt:""},on:{click:function(s){e.choose(!1,a,n,o,r)}}}),t("span",[e._v(e._s(i.privilege_title))])])})],2)})],2)})],2)})],2)])]),t("li",{directives:[{name:"show",rawName:"v-show",value:!e.isSee,expression:"!isSee"}]},[t("div",{staticClass:"add-save",on:{click:e.add_one}},[e._v("保存")])])])])])])],1)};a._withStripped=!0;var i={render:a,staticRenderFns:[function(){var e=this.$createElement,s=this._self._c||e;return s("tr",[s("th",[this._v("序号")]),s("th",[this._v("角色名称")]),s("th",[this._v("相关人员")]),s("th",[this._v("创建时间")]),s("th",[this._v("操作")])])},function(){var e=this.$createElement,s=this._self._c||e;return s("span",{staticClass:"li-left"},[s("label",[this._v("*")]),this._v("角色名称")])},function(){var e=this.$createElement,s=this._self._c||e;return s("span",{staticClass:"li-left"},[s("label",[this._v("*")]),this._v("角色权限")])}]};s.a=i}});