webpackJsonp([64],{"2FIH":function(e,a,t){"use strict";var s=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",[t("LeftNav",{attrs:{data:e.leftNav}}),t("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"admin-medal"},[t("h2",[e._v("星级勋章")]),t("ul",{staticClass:"medal-rule"},e._l(e.star_medal,function(a,s){return t("li",{key:s+"a"},[t("p",{staticClass:"p1"},[e._v(e._s(a.name))]),t("p",[t("img",{staticStyle:{"margin-right":"50px"},attrs:{src:a.image_color.value,alt:"",width:"40px"}}),t("img",{attrs:{src:a.image_gray.value,alt:"",width:"40px"}})]),t("p",{staticClass:"p2"},[e._v("\n          累计"+e._s(a.medal_rule.rule_type.name)+"\n          "),t("span",[e._v(e._s(a.medal_rule.rule_value))]),e._v("\n          "+e._s(a.medal_rule.rule_type.unit)+"\n        ")]),t("p",{staticClass:"p2"},[e._v("已发放："+e._s(a.person_medal_count))])])})),t("h2",[e._v("训练营勋章")]),t("ul",{staticClass:"medal-rule"},e._l(e.xly_medal,function(a,s){return t("li",{key:s+"b"},[t("span",{directives:[{name:"show",rawName:"v-show",value:a.type&&0===a.person_medal_count,expression:"item.type && item.person_medal_count === 0"}],staticClass:"delete",on:{click:function(t){e.delete_one(s,a.id)}}},[t("img",{attrs:{src:"/admin/images/medal/delete.png",alt:"",height:"20",width:"20"}})]),t("p",{staticClass:"p1"},[t("span",{directives:[{name:"show",rawName:"v-show",value:!a.type,expression:"!item.type"}]},[e._v(e._s(a.name))]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.name,expression:"item.name"},{name:"show",rawName:"v-show",value:a.type,expression:"item.type"}],attrs:{type:"text"},domProps:{value:a.name},on:{input:function(t){t.target.composing||e.$set(a,"name",t.target.value)}}})]),t("p",{staticClass:"p3"},[t("img",{directives:[{name:"show",rawName:"v-show",value:!a.type,expression:"!item.type"}],attrs:{src:a.image_gray.value,alt:"",width:"40px"}}),t("el-upload",{directives:[{name:"show",rawName:"v-show",value:a.type,expression:"item.type"}],staticClass:"avatar-uploader",attrs:{action:e.add_url,"show-file-list":!1,headers:e.headers,"on-success":e.handleAvatarSuccess,"before-upload":e.beforeAvatarUpload}},[t("img",{staticClass:"avatar",attrs:{src:a.image_gray.value}})])],1),t("p",[t("img",{directives:[{name:"show",rawName:"v-show",value:!a.type,expression:"!item.type"}],attrs:{src:a.image_color.value,alt:"",width:"40px"}}),t("el-upload",{directives:[{name:"show",rawName:"v-show",value:a.type,expression:"item.type"}],staticClass:"avatar-uploader",attrs:{action:e.add_url,"show-file-list":!1,"on-success":e.handleAvatarSuccess2,headers:e.headers,"before-upload":e.beforeAvatarUpload}},[t("img",{staticClass:"avatar",attrs:{src:a.image_color.value}})])],1),t("p",{staticClass:"p4"},[t("span",{directives:[{name:"show",rawName:"v-show",value:!a.type,expression:"!item.type"}],staticClass:"span"},[e._v(e._s(a.xly_name))]),t("el-select",{directives:[{name:"show",rawName:"v-show",value:a.type,expression:"item.type"}],attrs:{placeholder:"请选择"},on:{change:function(t){e.select_change(s,a.xly_id)}},model:{value:a.xly_id,callback:function(t){e.$set(a,"xly_id",t)},expression:"item.xly_id"}},e._l(e.xly_list,function(e,a){return t("el-option",{key:a,attrs:{label:e.training_name,value:e.id}})}))],1),t("p",{staticClass:"p2"},[e._v("\n          已发放："+e._s(a.person_medal_count)+"\n        ")]),t("p",{staticClass:"last-p"},[t("span",{directives:[{name:"show",rawName:"v-show",value:a.type,expression:"item.type"}],staticClass:"save",on:{click:function(a){e.xly_save(s)}}},[e._v("保存")]),t("span",{directives:[{name:"show",rawName:"v-show",value:!a.type,expression:"!item.type"}],staticClass:"edit",on:{click:function(a){e.xly_edit(s)}}},[e._v("编辑")])])])})),t("div",{staticClass:"add-btn",on:{click:e.add_medal}},[e._v("+ 添加训练营勋章")])])],1)};s._withStripped=!0;var n={render:s,staticRenderFns:[]};a.a=n},"6VWr":function(e,a){},H8Uz:function(e,a,t){"use strict";var s=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",{staticClass:"left_nav"},[t("ul",e._l(e.data,function(a,s){return t("li",{key:s,class:{active:a.active},on:{click:function(a){e.nav_choose(s)}}},[e._v("\n      "+e._s(a.name)+"\n    ")])}))])};s._withStripped=!0;var n={render:s,staticRenderFns:[]};a.a=n},RaBm:function(e,a,t){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var s=t("oT6Z"),n=t.n(s);for(var i in s)"default"!==i&&function(e){t.d(a,e,function(){return s[e]})}(i);var l=t("2FIH"),r=!1;var o=function(e){r||t("6VWr")},d=t("VU/8")(n.a,l.a,!1,o,"data-v-75b506d8",null);d.options.__file="pages\\admin\\medal\\rule.vue",a.default=d.exports},cJuq:function(e,a,t){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var s=t("niWl"),n=t.n(s);for(var i in s)"default"!==i&&function(e){t.d(a,e,function(){return s[e]})}(i);var l=t("H8Uz"),r=!1;var o=function(e){r||t("cdzv")},d=t("VU/8")(n.a,l.a,!1,o,null,null);d.options.__file="components\\admin\\LeftNav.vue",a.default=d.exports},cdzv:function(e,a){},niWl:function(e,a,t){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default={name:"leftNav",props:["data"],data:function(){return{}},methods:{nav_choose:function(e){var a=this;$.each(a.data,function(t,s){t===e?(s.active=!0,console.log(s.name),a.$store.commit("setNav",s.name)):s.active=!1}),this.$router.push({path:a.data[e].link})}},mounted:function(){for(var e in this.data)this.data[e].link==this.$route.path?(this.data[e].active=!0,this.$store.commit("setNav",this.data[e].name)):this.data[e].active=!1},watch:{data:function(e){for(var a in this.data)this.data[a].link==this.$route.path?(this.data[a].active=!0,this.$store.commit("setNav",this.data[a].name)):this.data[a].active=!1}}}},oT6Z:function(e,a,t){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var s=r(t("Xxa5")),n=r(t("exGp")),i=r(t("cJuq")),l=r(t("mtWM"));function r(e){return e&&e.__esModule?e:{default:e}}a.default={layout:"admin",name:"rule",components:{LeftNav:i.default},head:function(){return{title:"勋章规则",link:[{href:"/admin/css/medal.css",type:"text/css",rel:"stylesheet"}]}},data:function(){return{leftNav:[{name:"勋章发放列表",link:"/admin/medal",active:!1},{name:"勋章规则",link:"/admin/medal/rule",active:!0}],now_xly_ind:0,fullscreenLoading:!1,add_url:""}},asyncData:function(){var e=(0,n.default)(s.default.mark(function e(a){var t,n,i,l,r,o=a.store;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],n=[],i={url:"/manage/training/training_list",data:{page:1,psize:99999999}},e.next=4,o.dispatch("adminHttpGet",i);case 4:return l=e.sent,r={url:"/manage/medal/list"},e.next=8,o.dispatch("adminHttpGet",r);case 8:return e.sent.data.forEach(function(e,a){1===e.pid?t.push(e):(l.data.data.forEach(function(a,t){a.id===parseInt(e.medal_rule.rule_value)&&(e.xly_name=a.training_name)}),e.type=!1,e.xly_id=parseInt(e.medal_rule.rule_value),n.push(e))}),console.log("星级勋章",t),e.abrupt("return",{star_medal:t,xly_medal:n,xly_list:l.data.data,headers:{token:o.state.admin.token}});case 12:case"end":return e.stop()}},e,this)}));return function(a){return e.apply(this,arguments)}}(),methods:{get_list:function(){var e=(0,n.default)(s.default.mark(function e(){var a,t,n,i,l,r,o;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],n=[],(a=this).fullscreenLoading=!0,i={url:"/manage/training/training_list",data:{page:1,psize:999999999}},e.next=6,a.$store.dispatch("adminHttpGet",i);case 6:return l=e.sent,r={url:"/manage/medal/list"},e.next=10,a.$store.dispatch("adminHttpGet",r);case 10:(o=e.sent)&&(a.fullscreenLoading=!1),o.data.forEach(function(e,a){1===e.pid?t.push(e):(l.data.data.forEach(function(a,t){a.id===parseInt(e.medal_rule.rule_value)&&(e.xly_name=a.training_name)}),e.type=!1,e.xly_id=parseInt(e.medal_rule.rule_value),n.push(e))}),a.star_medal=t,a.xly_medal=n;case 15:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),xly_edit:function(e){this.now_xly_ind=e,$.each(this.xly_medal,function(a,t){t.type=a===e})},xly_save:function(){var e=this,a=this,t=a.now_xly_ind;console.log("iddidididid",a.xly_medal[t].id),(0,l.default)({method:"post",url:"/manage/medal/add_rule",baseURL:a.$store.state.admin.baseUrl,headers:{token:a.$store.state.admin.token},data:{id:a.xly_medal[t].id,name:a.xly_medal[t].name,image_color:a.xly_medal[t].image_color.name,image_gray:a.xly_medal[t].image_gray.name,rule_value:a.xly_medal[t].xly_id,rule_type:3,pid:2}}).then(function(t){console.log(t),0===t.data.code?(e.$message({message:"保存成功！",type:"success"}),a.get_list()):e.$message.error("保存失败！")}).catch(function(e){console.log(e)})},handleAvatarSuccess:function(e,a){var t=this.now_xly_ind;this.xly_medal[t].image_gray.value=e.data.file_url,this.xly_medal[t].image_gray.name=e.data.filename,console.log("回调1",e.data)},handleAvatarSuccess2:function(e,a){var t=this.now_xly_ind;this.xly_medal[t].image_color.value=e.data.file_url,this.xly_medal[t].image_color.name=e.data.filename,console.log("回调2",e.data)},beforeAvatarUpload:function(e){console.log("发送之前",e)},add_medal:function(){if(!this.comsys.adminCheckRole(this.$store.state.admin.adminRole.data,"medal","add_rule"))return this.$message({message:"警告，您无此权限",type:"warning"}),!1;this.xly_medal.push({id:"",xly_id:"",name:"",xly_name:"",image_gray:{value:"/admin/images/medal/header2.png",name:""},image_color:{value:"/admin/images/medal/header.png",name:""},person_medal_count:0,type:!1})},delete_one:function(e,a){var t=this,s=this;if(!this.comsys.adminCheckRole(this.$store.state.admin.adminRole.data,"medal","del"))return this.$message({message:"警告，您无此权限",type:"warning"}),!1;this.$confirm("此操作将永久删除该勋章, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){""===a?(s.xly_medal.splice(e,1),t.$message({message:"删除成功！",type:"success"})):(0,l.default)({method:"post",url:"/manage/medal/del",baseURL:s.$store.state.admin.baseUrl,headers:{token:s.$store.state.admin.token},data:{id:a}}).then(function(e){console.log("idaaaaa",e),0===e.data.code?(t.$message({message:"删除成功！",type:"success"}),s.get_list()):t.$message.error(e.data.message)}).catch(function(e){console.log(e)})}).catch(function(){t.$message({type:"info",message:"取消删除"})})},select_change:function(e,a){console.log(e);var t=this;t.xly_list.forEach(function(s,n){s.id===a&&(t.xly_medal[e].xly_name=s.training_name)})}},mounted:function(){this.add_url=this.$store.state.admin.baseUrl+"/common/file/add"}}}});