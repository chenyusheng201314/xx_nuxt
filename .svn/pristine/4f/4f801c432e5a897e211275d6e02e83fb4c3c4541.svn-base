webpackJsonp([96],{BgBw:function(e,s,t){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var n=i(t("Xxa5")),o=i(t("exGp"));function i(e){return e&&e.__esModule?e:{default:e}}s.default={layout:"companyManage",name:"role",data:function(){return{search_info:{role:"",time:[]},fullscreenLoading:!1,cover_type:1,cover_show:!1,user_info:{id:"",tit:""},now_user_id:""}},asyncData:function(){var e=(0,o.default)(n.default.mark(function e(s){var t,o,i,a,r=s.store;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t={url:"/company/acl/privilege_list"},e.next=3,r.dispatch("companyHttpGet",t);case 3:return 0===(o=e.sent).code?function e(s){s.forEach(function(s,t){if(s.isChoose=!1,!s.son)return!1;e(s.son)})}(o.data):o.data=[],i={url:"/company/acl/role_list",data:{role_name:"",start_time:"",end_time:"",page:1,psize:20}},e.next=8,r.dispatch("companyHttpGet",i);case 8:return a=e.sent,console.log("列表",a),e.abrupt("return",{add_info:{name:"",id:"",jurisdiction:o.data},roles_lists:a.data.data,paging:{total:a.data.total,currentPage:1,page_sizes:[10,20,30],page_size:20}});case 11:case"end":return e.stop()}},e,this)}));return function(s){return e.apply(this,arguments)}}(),methods:{get_list:function(){var e=(0,o.default)(n.default.mark(function e(){var s,t,o;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(s=this).fullscreenLoading=!0,t={url:"/company/acl/role_list",data:{role_name:s.search_info.role,start_time:s.search_info.time?s.search_info.time[0]:"",end_time:s.search_info.time?s.search_info.time[1]:"",page:s.paging.currentPage,psize:s.paging.page_size}},e.next=5,this.$store.dispatch("companyHttpGet",t);case 5:(o=e.sent)&&(s.fullscreenLoading=!1),s.roles_lists=o.data.data;case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),handleSizeChange:function(e){this.paging.page_size=e,this.get_list()},handleCurrentChange:function(e){this.paging.currentPage=e,this.get_list()},type_change:function(){var e=(0,o.default)(n.default.mark(function e(s,t){var o,i;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=this,1!==parseInt(s)){e.next=14;break}if(i=function e(s){s.forEach(function(t,n){if(t.isChoose=!1,!t.son)return!1;s=t.son,e(s)})},o.comsys.adminCheckRole(o.$store.state.company.companyRole.data,"acl","role_add")){e.next=7;break}return this.$message({message:"警告，您无此权限",type:"warning"}),e.abrupt("return",!1);case 7:o.cover_show=!0,o.cover_type=parseInt(s),o.add_info.name="",o.add_info.id="",i(o.add_info.jurisdiction),e.next=28;break;case 14:if(2!==s){e.next=27;break}if(o.comsys.adminCheckRole(o.$store.state.company.companyRole.data,"acl","role_add")){e.next=19;break}return this.$message({message:"警告，您无此权限",type:"warning"}),e.abrupt("return",!1);case 19:o.cover_show=!0,o.cover_type=parseInt(s),o.add_info.name=t.role_name,o.now_user_id=t.role_id,o.add_info.id=t.role_id,o.set_choose(o.add_info.jurisdiction),e.next=28;break;case 27:3===s&&(o.cover_show=!0,o.cover_type=parseInt(s),o.add_info.name=t.role_name,o.now_user_id=t.role_id,o.add_info.id=t.role_id,o.set_choose(o.add_info.jurisdiction));case 28:case"end":return e.stop()}},e,this)}));return function(s,t){return e.apply(this,arguments)}}(),set_choose:function(){var e=(0,o.default)(n.default.mark(function e(s){var t,o,i=this;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this,e.next=3,t.get_jurisdiction(t.now_user_id);case 3:o=e.sent,s.forEach(function(e,n){if(-1!==o.indexOf(e.privilege_id)?e.isChoose=!0:e.isChoose=!1,n===s.length-1&&(i.fullscreenLoading=!1),!e.son)return!1;s=e.son,t.set_choose(s)});case 5:case"end":return e.stop()}},e,this)}));return function(s){return e.apply(this,arguments)}}(),get_jurisdiction:function(){var e=(0,o.default)(n.default.mark(function e(s){var t,o,i,a;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=function e(s){s.forEach(function(s,n){if(t.push(parseInt(s.privilege_id)),!s.son)return!1;e(s.son)})},this.fullscreenLoading=!0,t=[],o={url:"/company/acl/role_info",data:{role_id:s}},e.next=7,this.$store.dispatch("companyHttpGet",o);case 7:return i=e.sent,a(i.data),e.abrupt("return",t);case 11:case"end":return e.stop()}},e,this)}));return function(s){return e.apply(this,arguments)}}(),delete_one:function(e,s,t){var i=this,a=this;if(!a.comsys.adminCheckRole(a.$store.state.company.companyRole.data,"acl","role_del"))return this.$message({message:"警告，您无此权限",type:"warning"}),!1;t.company.length>0?a.$message.error("无法删除，存在账号正在使用该角色"):this.$confirm("此操作将永久删除该角色, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((0,o.default)(n.default.mark(function e(){var t,o;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t={url:"/company/acl/role_del",data:{role_id:s}},e.next=3,a.$store.dispatch("companyHttpPost",t);case 3:0===(o=e.sent).code?(a.$message({type:"success",message:"删除成功!"}),a.get_list()):a.$message.error(o.message);case 5:case"end":return e.stop()}},e,i)}))).catch(function(){i.$message({type:"info",message:"已取消删除"})})},choose:function(e){var s=this,t=arguments.length<=1?void 0:arguments[1],n=arguments.length<=2?void 0:arguments[2],o=arguments.length<=3?void 0:arguments[3],i=arguments.length<=4?void 0:arguments[4];function a(){var e=0;$.each(s.add_info.jurisdiction[t].son,function(n,o){o.isChoose?e++:e+=0,0!==e&&(s.add_info.jurisdiction[t].isChoose=!0)})}function r(){var e=0;$.each(s.add_info.jurisdiction[t].son[n].son,function(o,i){i.isChoose?e++:e+=0,0!==e&&(s.add_info.jurisdiction[t].son[n].isChoose=!0)})}switch(arguments.length<=1?0:arguments.length-1){case 1:s.add_info.jurisdiction[t].isChoose=e,s.add_info.jurisdiction[t].son?c(s.add_info.jurisdiction[t].son,e):s.add_info.jurisdiction[t].isChoose=e;break;case 2:s.add_info.jurisdiction[t].son[n].isChoose=e,s.add_info.jurisdiction[t].son[n].son?c(s.add_info.jurisdiction[t].son[n].son,e):s.add_info.jurisdiction[t].son[n].isChoose=e,a();break;case 3:s.add_info.jurisdiction[t].son[n].son[o].isChoose=e,s.add_info.jurisdiction[t].son[n].son[o].son?c(s.add_info.jurisdiction[t].son[n].son[o].son,e):s.add_info.jurisdiction[t].son[n].son[o].isChoose=e,r(),a();break;case 4:s.add_info.jurisdiction[t].son[n].son[o].son[i].isChoose=e,function(){var e=0;$.each(s.add_info.jurisdiction[t].son[n].son[o].son,function(i,a){a.isChoose?e++:e+=0,0!==e&&(s.add_info.jurisdiction[t].son[n].son[o].isChoose=!0)})}(),r(),a()}function c(e,s){e.forEach(function(t,n){t.isChoose=s,t.son&&c(e=t.son,s)})}},role_save:function(){var e=(0,o.default)(n.default.mark(function e(){var s,t,o,i,a;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=function e(s){s.forEach(function(n,o){if(n.isChoose&&t.push(n.privilege_id),!n.son)return!1;s=n.son,e(s)})},t=[],a((s=this).add_info.jurisdiction),""===s.add_info.name||0===t.length){e.next=12;break}return o={url:"/company/acl/role_add",data:{role_id:s.add_info.id,role_name:s.add_info.name,role_status:1,privilege_id:t.join(",")}},e.next=8,s.$store.dispatch("companyHttpPost",o);case 8:0===(i=e.sent).code?(s.$message({type:"success",message:"操作成功!"}),s.cover_show=!1,s.get_list()):s.$message.error(i.message),e.next=13;break;case 12:s.$message.error("信息请填写完整!");case 13:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},mounted:function(){console.log("token",this.$store.state.company.token)},head:function(){return{title:"角色管理",link:[{href:"/company_manage/css/iconfont.css",type:"text/css",rel:"stylesheet"},{href:"/company_manage/css/role.css",type:"text/css",rel:"stylesheet"}]}}}},XmPT:function(e,s){},eiYg:function(e,s,t){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var n=t("BgBw"),o=t.n(n);for(var i in n)"default"!==i&&function(e){t.d(s,e,function(){return n[e]})}(i);var a=t("rxAm"),r=!1;var c=function(e){r||t("XmPT")},l=t("VU/8")(o.a,a.a,!1,c,"data-v-6e14cb1f",null);l.options.__file="pages\\company_manage\\index\\role.vue",s.default=l.exports},rxAm:function(e,s,t){"use strict";var n=function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"company-role"},[t("h2",[e._v("角色管理")]),t("p",{staticClass:"eng-name"},[e._v("Role management")]),t("ul",{staticClass:"search-info"},[t("li",[t("span",{staticClass:"li-span"},[e._v("角色名称")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.search_info.role,expression:"search_info.role"}],attrs:{type:"text"},domProps:{value:e.search_info.role},on:{input:function(s){s.target.composing||e.$set(e.search_info,"role",s.target.value)}}})]),t("li",[t("span",{staticClass:"li-span"},[e._v("创建时间")]),t("el-date-picker",{attrs:{type:"datetimerange","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss","default-time":["00:00:00","23:59:59"]},model:{value:e.search_info.time,callback:function(s){e.$set(e.search_info,"time",s)},expression:"search_info.time"}})],1),t("li",{staticClass:"last"},[t("span",{staticClass:"search-btn",on:{click:e.get_list}},[e._v("搜索")]),t("span",{staticClass:"add-btn",on:{click:function(s){e.type_change(1)}}},[e._v("+ 创建账号")])])]),t("table",[e._m(0),t("tbody",e._l(e.roles_lists,function(s,n){return t("tr",{key:n},[t("td",{attrs:{width:"120"}},[e._v(e._s(n+1))]),t("td",{attrs:{width:"200"}},[e._v(e._s(s.role_name))]),t("td",{attrs:{width:"680"}},e._l(s.company,function(s,n){return t("span",{key:n},[e._v(e._s(s.realname))])})),t("td",{attrs:{width:"350"}},[e._v(e._s(s.created_at))]),t("td",[t("span",{staticClass:"iconfont",on:{click:function(t){e.type_change(3,s)}}},[e._v("")]),t("span",{staticClass:"iconfont",on:{click:function(t){e.type_change(2,s)}}},[e._v("")]),t("span",{staticClass:"iconfont",on:{click:function(t){e.delete_one(n,s.role_id,s)}}},[e._v("")])])])}))]),t("div",{staticClass:"paging"},[t("el-pagination",{attrs:{"current-page":e.paging.currentPage,"page-sizes":e.paging.page_sizes,"page-size":e.paging.page_size,layout:"prev, pager, next, sizes, jumper",total:e.paging.total,"pager-count":5},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange,"update:currentPage":function(s){e.$set(e.paging,"currentPage",s)}}})],1),t("el-dialog",{attrs:{title:1===e.cover_type?"创建角色":2===e.cover_type?"编辑角色":"查看",visible:e.cover_show,"close-on-click-modal":!1,width:"40%"},on:{"update:visible":function(s){e.cover_show=s}}},[t("div",{staticClass:"cover-con"},[t("ul",[t("li",[t("span",{staticClass:"li-name"},[t("label",[e._v("*")]),e._v("角色名称")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.add_info.name,expression:"add_info.name"}],attrs:{type:"text",disabled:3===e.cover_type,maxlength:"10"},domProps:{value:e.add_info.name},on:{input:function(s){s.target.composing||e.$set(e.add_info,"name",s.target.value)}}})]),t("li",[t("span",{staticClass:"li-name"},[t("label",[e._v("*")]),e._v("角色名称")]),t("div",{staticClass:"jurisdiction"},[t("div",{staticClass:"jurisdiction-all"},[t("div",{directives:[{name:"show",rawName:"v-show",value:3===e.cover_type,expression:"cover_type === 3"}],staticClass:"jurisdiction-cover"}),e._l(e.add_info.jurisdiction,function(s,n){return t("div",{key:n,staticClass:"p1 p"},[t("span",{directives:[{name:"show",rawName:"v-show",value:!s.isChoose,expression:"!it1.isChoose"}],staticClass:"iconfont no-choose",on:{click:function(s){e.choose(!0,n)}}},[e._v("")]),t("span",{directives:[{name:"show",rawName:"v-show",value:s.isChoose,expression:"it1.isChoose"}],staticClass:"iconfont choose",on:{click:function(s){e.choose(!1,n)}}},[e._v("")]),t("span",{staticClass:"span"},[e._v(e._s(s.privilege_title))]),e._l(s.son,function(s,o){return t("div",{key:o,staticClass:"p2 p"},[t("span",{directives:[{name:"show",rawName:"v-show",value:!s.isChoose,expression:"!it2.isChoose"}],staticClass:"iconfont no-choose",on:{click:function(s){e.choose(!0,n,o)}}},[e._v("")]),t("span",{directives:[{name:"show",rawName:"v-show",value:s.isChoose,expression:"it2.isChoose"}],staticClass:"iconfont choose",on:{click:function(s){e.choose(!1,n,o)}}},[e._v("")]),t("span",{staticClass:"span"},[e._v(e._s(s.privilege_title))]),e._l(s.son,function(s,i){return t("div",{key:i,staticClass:"p3 p"},[t("span",{directives:[{name:"show",rawName:"v-show",value:!s.isChoose,expression:"!it3.isChoose"}],staticClass:"iconfont no-choose",on:{click:function(s){e.choose(!0,n,o,i)}}},[e._v("")]),t("span",{directives:[{name:"show",rawName:"v-show",value:s.isChoose,expression:"it3.isChoose"}],staticClass:"iconfont choose",on:{click:function(s){e.choose(!1,n,o,i)}}},[e._v("")]),t("span",{staticClass:"span"},[e._v(e._s(s.privilege_title))]),e._l(s.son,function(s,a){return t("div",{key:a,staticClass:"p4 p"},[t("span",{directives:[{name:"show",rawName:"v-show",value:!s.isChoose,expression:"!it4.isChoose"}],staticClass:"iconfont no-choose",on:{click:function(s){e.choose(!0,n,o,i,a)}}},[e._v("")]),t("span",{directives:[{name:"show",rawName:"v-show",value:s.isChoose,expression:"it4.isChoose"}],staticClass:"iconfont choose",on:{click:function(s){e.choose(!1,n,o,i,a)}}},[e._v("")]),t("span",{staticClass:"span"},[e._v(e._s(s.privilege_title))])])})],2)})],2)})],2)})],2)])])]),t("div",{directives:[{name:"show",rawName:"v-show",value:3!==e.cover_type,expression:"cover_type !== 3"}],staticClass:"add-save",on:{click:e.role_save}},[e._v("保存")])])])],1)};n._withStripped=!0;var o={render:n,staticRenderFns:[function(){var e=this.$createElement,s=this._self._c||e;return s("tr",[s("th",[this._v("序号")]),s("th",[this._v("角色名称")]),s("th",[this._v("相关人员")]),s("th",[this._v("创建时间")]),s("th",[this._v("操作")])])}]};s.a=o}});