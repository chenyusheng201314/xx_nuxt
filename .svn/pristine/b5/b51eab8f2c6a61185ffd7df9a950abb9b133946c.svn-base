webpackJsonp([113],{MgHf:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o(a("mvHQ")),s=o(a("Xxa5")),n=o(a("exGp")),r=a("PntQ");function o(e){return e&&e.__esModule?e:{default:e}}t.default={layout:"admin",name:"admin_body",data:function(){return{addInfo:{descriptionArr:[""],forced_upgrade:0},dialogViewVisible:!1,dialogFormVisible:!1,formLabelWidth:"120px",saveAction:"",choose:null,map:{},uploadMsg:"",isUpload:!1,rules:{device_type:[{required:!0,message:"请选择系统",trigger:"blur"}],version:[{required:!0,message:"请输入目前版本",trigger:"blur"}],forced_upgrade:[{required:!0,message:"请选择是否强制升级",trigger:"blur"}],upgrade_time:[{required:!0,message:"请选择更新时间",trigger:"blur"}],url:[{required:!0,message:"请输入应用下载地址",trigger:"blur"},{validator:this.comssr.validatorLen50,trigger:"blur"}],description:[{required:!0,message:"请输入版本特性",trigger:"blur"}]},fileList:[]}},asyncData:function(){var e=(0,n.default)(s.default.mark(function e(t){var a,i,n=t.store;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a={url:"/manage/app_upgrade_config/list",data:{page:1,psize:20}},e.next=3,n.dispatch("adminHttpGet",a);case 3:return i=e.sent,e.abrupt("return",{updateInfo:i.data.data,pageInfo:{total:i.data.total,pageSizes:[10,20,30,400],pageSize:20,currentPage:parseInt(i.data.page)}});case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),methods:{handleSuccess:function(e,t,a){console.log(e),this.$set(this.addInfo,"url",t.response.data.file_url),this.isUpload=!1},beforeUpload:function(e,t){this.isUpload=!0;var a=e.name.split("."),i="apk"==a[a.length-1];return i||(this.uploadMsg="上传只能是apk格式! ",this.isUpload=!1,!1)},handleRemove:function(e,t){console.log(e,t)},handlePreview:function(e){console.log(e)},handleExceed:function(e,t){this.$message.warning("当前限制选择 1 个文件，本次选择了 "+e.length+" 个文件，共选择了 "+(e.length+t.length)+" 个文件")},beforeRemove:function(e,t){return this.$confirm(this.uploadMsg+"确定移除 "+e.name+"？")},addNew:function(){this.addInfo.descriptionArr.push("")},descDel:function(e){this.addInfo.descriptionArr.splice(e,1)},see:function(e){this.addInfo=JSON.parse((0,i.default)(this.updateInfo[e])),this.$set(this.addInfo,"descriptionArr",this.addInfo.description.split("@!@")),this.dialogViewVisible=!0},add:function(){if(!this.comsys.adminCheckRole(this.$store.state.admin.adminRole.data,"app_upgrade_config","add"))return this.$message({message:"警告，您无此权限",type:"warning"}),!1;this.isUpload=!1,this.addInfo={descriptionArr:[""],forced_upgrade:0},this.saveAction="add",this.dialogFormVisible=!0},edit:function(e){this.choose=e,this.saveAction="edit",this.isUpload=!1,this.addInfo=JSON.parse((0,i.default)(this.updateInfo[e])),this.$set(this.addInfo,"descriptionArr",this.addInfo.description.split("@!@")),this.dialogFormVisible=!0,this.$refs.addInfo.resetFields()},submitForm:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return console.log("error submit!!"),!1;t.update()})},update:function(){var e=(0,n.default)(s.default.mark(function e(){var t;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.$set(this.addInfo,"description",this.addInfo.descriptionArr.join("@!@")),t={url:"/manage/app_upgrade_config/add",data:this.addInfo},e.next=4,this.$store.dispatch("adminHttpPost",t);case 4:e.sent,this.setData(),this.dialogFormVisible=!1;case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),handleSizeChange:function(e){console.log("每页 "+e+" 条"),this.pageInfo.pageSize=e,this.setData()},handleCurrentChange:function(e){this.pageInfo.currentPage=e,console.log("当前页: "+e),this.setData()},setTime:function(){this.addInfo.upgrade_time=(0,r.formatDate)(this.addInfo.upgrade_time,"yyyy-MM-dd hh:mm:ss")},setData:function(){var e=(0,n.default)(s.default.mark(function e(){var t,a;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.map.page=this.pageInfo.currentPage,this.map.psize=this.pageInfo.pageSize,t={url:"/manage/app_upgrade_config/list",data:this.map},e.next=5,this.$store.dispatch("adminHttpGet",t);case 5:a=e.sent,this.updateInfo=a.data.data,this.pageInfo.page=parseInt(a.data.page),this.pageInfo.total=a.data.total;case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},computed:{sortKeywords:function(){return this.sortByKey(this.keywords,"sort")}},mounted:function(){},watch:{}}},PntQ:function(e,t,a){"use strict";function i(e){return("00"+e).substr(e.length)}Object.defineProperty(t,"__esModule",{value:!0}),t.formatDate=function(e,t){/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length)));var a={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds()};for(var s in a)if(new RegExp("("+s+")").test(t)){var n=a[s]+"";t=t.replace(RegExp.$1,1===RegExp.$1.length?n:i(n))}return t}},ZaJA:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("MgHf"),s=a.n(i);for(var n in i)"default"!==n&&function(e){a.d(t,e,function(){return i[e]})}(n);var r=a("zpqN"),o=a("VU/8")(s.a,r.a,!1,null,null,null);o.options.__file="pages\\admin\\app\\update.vue",t.default=o.exports},zpqN:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app_update"},[a("div",{staticClass:"app_update_setting"},[a("div",{staticClass:"app_update_title"},[a("div",{staticClass:"title"},[e._v("\n          搜索框配置\n       ")]),a("div",{staticClass:"btn",attrs:{"data-toggle":"modal","data-target":"#myModal"},on:{click:function(t){e.add()}}},[a("img",{attrs:{src:"/admin/images/app_index_add.png"}}),e._v(" 添加\n       ")])]),a("div",{staticClass:"table-responsive"},[a("table",{staticClass:"table"},[a("tbody",[e._m(0),e._l(e.updateInfo,function(t,i){return a("tr",{key:i},[a("td",[e._v(e._s(i+1))]),a("td",[e._v(e._s(1==t.device_type?"IOS":"android")+" ")]),a("td",[e._v(e._s(t.version))]),a("td",["1"==t.forced_upgrade?a("span",[e._v("是")]):a("span",[e._v("否")])]),a("td",[t.description.split("@!@").join("，").length>10?a("el-tooltip",{attrs:{placement:"top"}},[a("div",{staticStyle:{width:"300px"},attrs:{slot:"content"},slot:"content"},[e._v(e._s(t.description.split("@!@").join("，")))]),a("el-button",[e._v(e._s(t.description.split("@!@").join("，").substr(0,10))+"...")])],1):a("span",[e._v(e._s(t.description.split("@!@").join("，")))])],1),a("td",[e._v(e._s(t.upgrade_time))]),a("td",[a("span",{staticClass:"btn btn_set",on:{click:function(t){e.edit(i)}}},[e._v("编辑")]),a("span",{staticClass:"btn_del",on:{click:function(t){e.see(i)}}},[e._v("查看")])])])})],2)])]),a("div",{staticClass:"page"},[a("el-pagination",{attrs:{"current-page":e.pageInfo.currentPage,"page-sizes":e.pageInfo.pageSizes,"page-size":e.pageInfo.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.pageInfo.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)]),e.dialogFormVisible?a("el-dialog",{attrs:{title:"APP更新配置",visible:e.dialogFormVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-form",{ref:"addInfo",attrs:{model:e.addInfo,rules:e.rules}},[a("el-form-item",{attrs:{label:"系统","label-width":e.formLabelWidth,prop:"device_type"}},[a("el-radio",{attrs:{label:1},model:{value:e.addInfo.device_type,callback:function(t){e.$set(e.addInfo,"device_type",t)},expression:"addInfo.device_type"}},[e._v("iOS")]),a("el-radio",{attrs:{label:2},model:{value:e.addInfo.device_type,callback:function(t){e.$set(e.addInfo,"device_type",t)},expression:"addInfo.device_type"}},[e._v("android")])],1),a("el-form-item",{attrs:{label:"目前版本","label-width":e.formLabelWidth,prop:"version"}},[a("el-input",{attrs:{"auto-complete":"off",maxlength:"10"},model:{value:e.addInfo.version,callback:function(t){e.$set(e.addInfo,"version",t)},expression:"addInfo.version"}})],1),a("el-form-item",{attrs:{label:"强制升级","label-width":e.formLabelWidth,prop:"forced_upgrade"}},[a("el-radio",{attrs:{label:1},model:{value:e.addInfo.forced_upgrade,callback:function(t){e.$set(e.addInfo,"forced_upgrade",t)},expression:"addInfo.forced_upgrade"}},[e._v("是")]),a("el-radio",{attrs:{label:0},model:{value:e.addInfo.forced_upgrade,callback:function(t){e.$set(e.addInfo,"forced_upgrade",t)},expression:"addInfo.forced_upgrade"}},[e._v("否")])],1),a("el-form-item",{attrs:{label:"更新时间","label-width":e.formLabelWidth,prop:"upgrade_time"}},[a("el-date-picker",{attrs:{type:"datetime","value-format":"yyyy-MM-dd",placeholder:"选择日期时间"},model:{value:e.addInfo.upgrade_time,callback:function(t){e.$set(e.addInfo,"upgrade_time",t)},expression:"addInfo.upgrade_time"}})],1),1==e.addInfo.device_type?a("el-form-item",{attrs:{label:"应用下载地址","label-width":e.formLabelWidth,prop:"url"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.addInfo.url,callback:function(t){e.$set(e.addInfo,"url",t)},expression:"addInfo.url"}})],1):e._e(),2==e.addInfo.device_type?a("el-form-item",{attrs:{label:"apk文件上传","label-width":e.formLabelWidth,prop:"url"}},[a("el-input",{attrs:{"auto-complete":"off",disabled:""},model:{value:e.addInfo.url,callback:function(t){e.$set(e.addInfo,"url",t)},expression:"addInfo.url"}}),a("el-upload",{staticClass:"upload-demo",attrs:{action:e.$store.state.admin.fileAddUrl,headers:{token:e.$store.state.admin.token},"before-upload":e.beforeUpload,"on-preview":e.handlePreview,"on-remove":e.handleRemove,"on-success":e.handleSuccess,"before-remove":e.beforeRemove,multiple:"",limit:1,"on-exceed":e.handleExceed,"file-list":e.fileList}},[a("el-button",{attrs:{size:"small",type:"primary",disabled:e.isUpload}},[e._v(e._s(e.isUpload?"上传中...":"点击上传"))]),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("只能上传apk文件")])],1)],1):e._e(),e._l(e.addInfo.descriptionArr,function(t,i){return a("div",{key:i,staticStyle:{position:"relative"}},[a("el-form-item",{attrs:{label:0==i?"版本特性":"","label-width":e.formLabelWidth,prop:"descriptionArr["+i+"]",rules:{required:!0,message:"必填",trigger:"blur"}}},[a("el-input",{attrs:{"auto-complete":"off",maxlength:"50"},model:{value:e.addInfo.descriptionArr[i],callback:function(t){e.$set(e.addInfo.descriptionArr,i,t)},expression:"addInfo.descriptionArr[index]"}})],1),e.addInfo.descriptionArr.length>1?a("div",{staticClass:"add_info_more_del",on:{click:function(t){e.descDel(i)}}},[e._v("×")]):e._e()],1)}),a("div",{staticClass:"base_btn_add",staticStyle:{float:"left","margin-left":"120px"},on:{click:function(t){e.addNew()}}},[a("img",{attrs:{src:"/admin/images/app_index_add.png"}}),e._v(" 增加")])],2),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.submitForm("addInfo")}}},[e._v("确 定")])],1)],1):e._e(),a("el-dialog",{attrs:{title:"APP更新配置",visible:e.dialogViewVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogViewVisible=t}}},[a("el-form",{attrs:{model:e.addInfo}},[a("el-form-item",{attrs:{label:"系统","label-width":e.formLabelWidth}},[e._v("\n      "+e._s(e.addInfo.device_name)+"\n    ")]),a("el-form-item",{attrs:{label:"目前版本","label-width":e.formLabelWidth}},[e._v("\n      "+e._s(e.addInfo.version)+"\n    ")]),a("el-form-item",{attrs:{label:"强制升级","label-width":e.formLabelWidth}},["1"==e.addInfo.forced_upgrade?a("span",[e._v("是")]):a("span",[e._v("否")])]),a("el-form-item",{attrs:{label:"更新时间","label-width":e.formLabelWidth}},[e._v("\n      "+e._s(e.addInfo.upgrade_time)+"\n    ")]),a("el-form-item",{attrs:{label:"应用下载地址","label-width":e.formLabelWidth}},[e._v("\n      "+e._s(e.addInfo.url)+"\n    ")]),a("el-form-item",{attrs:{label:"版本特性","label-width":e.formLabelWidth}},e._l(e.addInfo.descriptionArr,function(t,i){return a("p",{key:i,staticStyle:{position:"relative"}},[e._v("\n          "+e._s(e.addInfo.descriptionArr[i])+"\n       ")])}))],1)],1)],1)};i._withStripped=!0;var s={render:i,staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("tr",[t("th",{attrs:{width:"6%"}},[this._v("序号")]),t("th",{attrs:{width:"8%"}},[this._v("系统")]),t("th",{attrs:{width:"10%"}},[this._v("目标版本")]),t("th",{attrs:{width:"8%"}},[this._v("强制更新")]),t("th",{attrs:{width:"8%"}},[this._v("版本特性")]),t("th",{attrs:{width:"10%"}},[this._v("更新时间")]),t("th",{attrs:{width:"12%"}},[this._v("操作")])])}]};t.a=s}});